---
title: "Analysis Workflow"
author: "Alexandra Cassano"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: tibble
    highlight: tango
    theme: united
    toc: yes
    toc_float:
        collapsed: true
  pdf_document:
    number_sections: yes
    keep_tex: yes
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

-   This code should be usable to analyze your bulk RNA-seq data.

-   **Please read through the document before making any changes. This is a template and will indicate where you need to make changes for your specific experiment.**

-   This R markdown file is broken down into "code chunks" that can be run individually.

    -   Downstream chunks rely on upstream chunks so running code out of order is not recommended.

    -   In R Studio, you can run a chunk by hitting the "play button (▶️)" on the top right of the chunk.

    -   You can run all upstream chunks by clicking the button that has a down arrow pointing to a green bar.

-   I've tried to include handy-dandy tables throughout this template to describe the inputs you need to provide for the functions I've written.
    The functions all also have R documentation attached to them.
    In R studio if you put your mouse cursor on the function name and hit F1 it should pop up the help information for the function.
    Alternatively, click on the function name and use the toolbar.
    Click the 'Code' tab then find 'Go to Help'.

*Built with R version 4.3.2. Most recent template changes made on Dec 11 2023*

# Prepare work-space

First you have to set up the "work-space" so that your computer knows what code it will need to import and where all of the raw data is.
This will also get everything set up in the right format for downstream code.

## Install Packages

This segment of code should only be run if the packages are not already installed on whichever computer this is being run on.
In order to have this chunk run, hit the run chunk button.
If you're running chunk by chunk be sure to run this chunk the first time but do not run this code subsequent times.

[**Do not edit this chunk (just hit the run chunk button if needed)**]{style="color: red"}

```{r install_pkgs, eval=FALSE}
install.packages(c(
    "BiocManager",
    "tidyverse",
    "gplots",
    "ggplot2",
    "ggrepel",
    "stringi",
    "pheatmap",
    "stats",
    "RColorBrewer"
))
BiocManager::install(c(
    "DESeq2",
    "GO.db",
    "GOstats",
    "pathview",
    "gage",
    "uwot",
    "gageData",
    "GenomicRanges",
    "Repitools",
    "clusterProfiler",
    "org.Mm.eg.db",
    "DOSE",
    "pathview",
    "treemap",
    "biomaRt",
    "ashr"
))
BiocManager::install("pcaExplorer")
BiocManager::install("enrichplot")
```

## Load packages

Packages need to be loaded every time you run the code.
Run this chunk every time you open a new R session.
These will be used for data manipulation, analysis, and visualization.
Leave this chunk as `eval=TRUE`

[**Do not edit this chunk**]{style="color: red"}

```{r load_pkgs, eval=TRUE}
library(devtools)
library(roxygen2)
library(tidyverse)
library(org.Mm.eg.db)
library(utils)
library(stringi)
library(stringr)
library(knitr)
library(rmarkdown)
library(biomaRt)
library(DESeq2)
library(ashr)
library(ggplot2)
library(ggrepel)
library(RColorBrewer)
library(uwot)
library(ggVennDiagram)
library(pheatmap)
library(tinytex)
library(stats)
library(enrichplot)
library(clusterProfiler)
library(DOSE)
library(org.Mm.eg.db)
library(ggpubr)
library(treemap)
library(pathview)
library(rrvgo)
library(paletteer)
library(colorblindr)
if (!require(devtools)) {
    install.packages("devtools")
}
devtools::install_github("JamesJoly/DGSEA")
devtools::install_github("amcassano/RNAseqAnalysisPackage")
library(DGSEA)
library(analyzeRNA)
library(pcaExplorer)
library(PCAtools)
```

## Set working directory

This chunk will set the 'current working directory'.
You must change this to reflect what folder you'll be working in.
The working directory is all where all outputs will be saved.
All files being imported should also be in this folder.

Your working directory should contain:

1.  CSV file containing all of the raw read counts obtained from the fastq files

2.  CSV file containing the meta-data for your experiment

3.  CSV files with any gene sets of interest

[**Change the working directory variable (change what is in the quotes) You will need to use the complete path. The path should end with the name of the folder, you should omit the trailing '/'**]{style="color: red"}

```{r workingdirectory, eval=TRUE}
# set working directory
cwd <- "C:/Users/Lexi Cassano/Documents/GitHub/ButyrateRNAseq"
setwd(cwd)
```

## Data import & preparation

### Import CSV files

-   The `raw_counts` variable is set as the csv file containing the output of feature counts after using STAR to align reads to the reference genome.
    The csv file must be "cleaned up" by removing unneeded columns such as *Chr*, *start*, *end* prior to loading into R.

-   The `meta` variable is set as the csv file containing metadata about the current experiment.
    At a minimum, it must contain sample names and conditions/groups.

    -   **The condition column must be named "Group" & the sample ID column must be named "SampleID".**

    -   You can also include other information such as sac day, cell type, or anything else you might want to keep track of, let me know if you do though so I can help with some minor code adjustments.

-   Samples not of interest (in a combined experiment, irrelevant groups) should be removed from both raw counts and metadata.

-   The samples **must** be in the same order in the `meta` file as they are in `raw_counts`.

-   Pre-filtering is applied to the raw data to remove any genes that have a total count number across samples less than the user defined minimum.
    Additionally, genes that have a total count that is less than a user defined value, when the single max count is subtracted are removed.
    This is done to filter out genes that have a high read count for just one sample, but are not expressed in other samples.
    These filtering steps minimize noise and remove outliers.

[**Change`countsCSV` and `metadataCSV` file names**]{style="color: red"}

```{r import_data, eval=TRUE}
# import files
countsCSV <- "sepulveda_rawcounts.csv"
countsCSV <- paste(cwd, countsCSV, sep = "/")
raw_counts <- read.csv(countsCSV, header = TRUE, sep = ",")

metadataCSV <- "sepulveda_metadata.csv"
metadataCSV <- paste(cwd, metadataCSV, sep = "/")
meta <- read.csv(metadataCSV, header = TRUE, sep = ",")
```

### CSV Cleanup

This code will accomplish a few things in order to get the files in the format needed for the rest of the code:

1.  Set the row names as the GeneID in the counts file

2.  Set groups as the data type `factor` :

    -   Replace whats in quotes with the names of your groups (add or remove lines as necessary). The contents of the `""` must *exactly* match the group as it is written in your metadata csv file. The order they appear is the order your groups will appear in plots and legends so fill in accordingly

3.  Apply pre-filtering to your data to retain only rows that have more than minimum counts across all samples and have a total count that is less than a user defined value, when the single max count is subtracted are removed.
    The more samples you have, the higher the number should be, the fewer samples you have the lower the number should be.
    It makes sense to set the number 300-1000.
    This is done to filter out genes that have a high read count for just one sample, but are not expressed in other samples.
    This minimizes noise and removes outliers.

[**Change the group names, count minimum, number of samples**]{style="color: red"}

```{r csv_cleanup, eval=TRUE}
# renames each row as the GeneID and removes the Geneid column
rownames(raw_counts) <- raw_counts$Geneid
raw_counts <- dplyr::select(raw_counts, -Geneid)

# set groups as factors
meta$Group <- factor(meta$Group,
    levels = c(
        "Control",
        "Butyrate"
    )
)

# pre-filtering
count_minimum <- 150
numberofsamples <-
    allcols <- colnames(raw_counts)
raw_counts$row_max <- apply(raw_counts, 1, max)
raw_counts <- raw_counts %>%
    dplyr::filter(raw_counts$row_max > count_minimum) %>%
    dplyr::select(-c(row_max))

# set the sample ID as the row name for the metadata
rownames(meta) <- meta$SampleID
meta <- meta %>% dplyr::select(-c(SampleID))
```

## Set colors, shapes, labels for plots

-   This code will set global variables for plotting such as the color palette, labels, and shapes.
    The aesthetics dataframe is created for use in creating consistent plots throughout.
    One of the package functions has the different options for the colors and shapes in it.

-   For colors you can choose from black, blue, orange, green, purple, red, yellow, brown, white, or grey.
    Fill the `""` with your choice, add or remove rows as necessary but make sure each row ends in a `,` except the last row.
    If you want a solid symbol make the fill and outline the same color.
    If you would like an open symbol set the fill as white.

-   For shapes you can choose from 'circle', 'crossed circle', 'diamond', 'crossed diamond', 'square', 'crossed square', 'triangle up', 'triangle down', 'x', 'plus', 'asterik'.
    Fill in the `""` (same concept as outline color)

-   For each group/condition you have you will specify the shape of symbol as well as the outline and fill colors desired.
    Each should be in the same order of the groups, the code below will also print out your options and the order of your groups.

[**Do not edit this chunk, just run it.**]{style="color: red"}

```{r global_aesthetics, eval=TRUE}
# get the names of the groups to assign to the colors/shapes
sample_labels <- (meta$Group)
group_labels <- unique(sample_labels) %>%
    sort() %>%
    print()

analyzeRNA::getPalettes()
```

[**Change the colors and shapes. Make sure that the number of arguments provided match the number of conditions you have. Add or remove lines from the `anno_colors` in the below format for the number of different conditions you have.**]{style="color: red"}

```{r set_aesthetics, eval=TRUE}
plot_aes <- analyzeRNA::set_aes(
    group_labels,
    c("circle", "square"),
    c("green", "black"),
    c("green", "black")
)

# for heatmaps
anno_colors <- list(
    Group = c(
        Control = as.character(plot_aes$outlineID[1]),
        Butyrate = as.character(plot_aes$outlineID[2])
    )
)
```

------------------------------------------------------------------------

# Getting results: DEGs and Normalized Counts

Now that you've got everything set up, its time to start analysis!
The DESeq2 package has functions to find differentially expressed genes, statistics associated with this, and normalized counts.

First a DESeq data object is created using `raw_counts` and `meta`, specifying that `group` is the variable of interest in the metadata table.
The `DESeq` function is run and from this output, normalized results (rlog transformed, and normalized counts).

Differential gene expression requires pairwise comparisons, however analysis using the normalized counts (UMAP, PCA, Sample Distances) use all samples at once.

## Create DESeq object and run DESeq

-   This code will construct the `DESeqDataSet` which takes the raw counts and metadata as inputs.

-   `design = ~Group` means that Group is your experimental variable, this variable expresses how the counts for each gene depend on the variables in metadata.
    If the experimental design is more complex than just group (i.e. group and cell type) then you can combine variables (i.e. `~ Group + CellType`) (but lmk if this is the case as we might need to make some slight edits to the code).

-   DESeq uses a generalized linear model and outputs a DEseq2 object, we will use this to get normalized counts, p-values, and log-2 fold changes.

[**Only change this chunk if you need to change the experiment design**]{style="color: red"}

```{r DESeq2, eval=TRUE}
dseq <- analyzeRNA::getDESeq(raw_counts, meta, ~Group)
```

## Regularized Log Transformation (rLog)

-   This code will apply a regularized log transformation to the data.
    This transforms the count data to the log2 scale in a way which minimizes differences between samples for rows with small counts, and which normalizes with respect to library size.

-   The `rlogtransformation` produces a similar variance stabilizing effect as `varianceStabilizingTransformation`.
    rlog is more robust in the case when the size factors vary widely.
    The rlog transformation takes more time to calculate than the VST function but it is more robust.

-   The transformation is useful when checking for outliers or as input for machine learning techniques such as clustering or linear discriminant analysis.

-   rlog takes as input a `DESeqDataSet` and returns a `RangedSummarizedExperiment` object.
    We will also save this same information as a data frame.
    We need both for various parts of code below.

-   `blind = FALSE` must be included in the code.
    This determines whether to blind the transformation to the experimental design.
    `blind=TRUE` should be used for comparing samples in an manner unbiased by prior information on samples (for QC).
    `blind=FALSE` should be used for transforming data for downstream analysis, where the full use of the design information should be made.
    If many of genes have large differences in counts due to the experimental design, it is important to set `blind=FALSE` for downstream analysis.

[**Do not edit this chunk**]{style="color: red"}

```{r rlog_normalization, eval=TRUE}
rlog_norm <- DESeq2::rlog(dseq, blind = FALSE)
rlog_df <- as.data.frame(SummarizedExperiment::assay(rlog_norm))
```

## Pairwise comparisons

-   Multiple pairwise comparisons can be made to determine the differentially expressed genes for any 2 given groups.
    Pairwise comparisons between 2 specified groups are saved as objects for use further on.

-   You can choose to use a Log Fold Change shrinking algorithm.
    This mitigates the effects of any single sample on the log fold change calculations, minimizing noise.
    Add `log2FCshrink = TRUE` to the function call if you want to use this.
    The calculation used is the "ashr" algorithm (@stephens2016.)

: Pairwise Comparison Function Inputs

[**Add the desired comparisons, change the names of the numerator and denominator and the names of the objects you're storing the results in.**]{style="color: red"}

```{r degs, eval=TRUE}
resultsNames(dseq)

butyrate_vs_control <- analyzeRNA::pairwiseDEGresults(
    numerator = "Butyrate",
    denominator = "Control",
    deseq_obj = dseq
)
```

# Annotate Results

-   The initial `raw_counts` table, and therefore all DESeq results derived from it, use the *Ensembl ID* to identify each gene.
    However, this is not a useful identifier for most humans.

-   The BiomaRt package can be used to match the *Ensembl ID* with it's corresponding *MGI Symbol*, *MGI Description*, (and optionally things like the *Gene Biotype*, and *Entrez (NCBI) ID*).

-   The genemap can be altered to omit or include different attributes as needed.
    The genemap is then used along with a `deseq results object` in the `annotate_biomart()` function to add these descriptors to the results.

-   Any data frame that has *Ensembl ID*s in a column called `GeneID` can be used in this annotation function.
    This is required for using the annotation

## Make genemap

The genemap will create a data frame that includes all of the Ensembl Gene IDs in your entire data set and their corresponding MGI symbol and description.

[**Do not change (unless you want to add more things like gene biotype)**]{style="color: red"}

```{r make_genemap, eval=TRUE}
allgenes <- tibble::rownames_to_column(rlog_df, var = "GeneID")
allgenes <- select(allgenes, GeneID)
gmap <- analyzeRNA::createGenemap(allcounts = allgenes, GMattributes = c("ensembl_gene_id", "mgi_symbol", "mgi_description"))
```

## Annotate pairwise comparisons (DEGs)

: Annotation Function Inputs

[**Add all of your pairwise comparisons, so all of your results get annotated**]{style="color: red"}

```{r annotate_degs, eval=TRUE}
butyrate_vs_control <- analyzeRNA::annotate_biomart(butyrate_vs_control, gmap, gmattri = c("MGI_Symbol", "MGI_Desc"))
butyrate_vs_control <- dplyr::filter(butyrate_vs_control, !is.na(Adj_P_Value), !is.na(MGI_Symbol))
rlog_df <- tibble::rownames_to_column(rlog_df, var = "GeneID")
rlog_df <- analyzeRNA::annotate_biomart(
    rlog_df, gmap,
    gmattri = c("MGI_Symbol", "MGI_Desc")
)
mgis <- butyrate_vs_control$MGI_Symbol
rlog_filtered <- dplyr::filter(rlog_df, MGI_Symbol %in% mgis)

# export_genelist(rlog_df, "rlogNormalizedCounts.csv")
```

# Filter & sort significant DEGs

-   The list of genes returned by the `results` function of the DESeq2 package contains all the genes above a 0.1 P-value. This is very generous filtering, especially with so many genes and so many pairwise comparisons being done. The results also include some genes that have uncalculated P-values or Log2 Fold Changes due to the presence of a sample that has been detected as "an extreme outlier". There are also results with uncalculated adjusted P-values if there is a very low mean normalized count.
-   The `signif_deg` function will filter out these genes and only keep DEGs that meet a user specified adjusted P-value threshold and log 2 fold change threshold.
    -   In addition, it will add a `Change Direction` column to indicate if a gene is up-regulated or down-regulated in the experimental group compared to the baseline group (as specified when retrieving results above).
    -   `Change Metric` is also added to each gene and the resultant data frame will be sorted according to this. The metric is calculated as $Change\space Metric = \log_2(Fold \space Change) *-\log(adj.\space P \space value)$. : Filter DEGs function inputs

[**Change threshold values (if desired), and adjust the results data frames being generated**]{style="color: red"}

```{r signifDEG, eval=TRUE}
# set thresholds for adjusted P values and log2 fold changes in determining which genes to keep as significant
padj_threshold <- 0.05
l2fc_threshold <- 0.5

# create ranked and filtered list of dif expr genes
ranked_Butyrate_vs_Control <- analyzeRNA::signif_deg(butyrate_vs_control, padj_threshold, l2fc_threshold, entrezid = F)
```

# Export lists of significantly DEGs

The `export_genelist` function will save the output of the `signif_deg` function as a csv, exporting it to the current working directory.
The option to export just those genes that are up-regulated, just those that are down-regulated, or all genes is included.
**Do NOT include white space in the file name** : Export DEGs function inputs

[**Change the exports and the file names, feel free to export just up/down/both and not all three**]{style="color: red"}

```{r exportlists, eval=FALSE, message=FALSE, warning=FALSE}
analyzeRNA::export_genelist(ranked_Butyrate_vs_Control, filename = "But vs Ctrl", direction = "up")
analyzeRNA::export_genelist(ranked_Butyrate_vs_Control, filename = "but vs ctrl", direction = "down")
analyzeRNA::export_genelist(ranked_Butyrate_vs_Control, filename = "but vs ctrl")
analyzeRNA::export_genelist(butyrate_vs_control, filename = "butyrate vs ctrl all")
```

------------------------------------------------------------------------

# Data visualizations

-   For the sheer amount of data in an RNAseq experiment, one of the most useful tools is data visualizations.

-   This section includes dimensionality reduction visualization techniques as well visualizations of pairwise comparisons and visualizations of expression of specific genes of interest.

-   Visualizations that use all of the samples across conditions will use the rlog normalized data.
    Visualizations showing DEGs between two conditions will use the annotated results of pairwise comparisons.

## Sample to Sample Distances

Plotting sample distances will illustrate the overall similarity between samples.
This can be compared to what is expected by the experiment design.
Rlog transformed data will be used for this to ensure that sample distance isn't overly due to certain highly expressed genes.

[**Do not edit this chunk**]{style="color: red"}

```{r sample_distances, eval=TRUE}
analyzeRNA::sample_distances(rlog_norm, anno_colors, meta)
```

## Principal Component Analysis

-   Principal component analysis (PCA) will illustrate the differences between samples as a whole, reducing the number of dimensions.
    PCA is most useful for a smaller number of samples (i.e. what we're working with in bulk RNA seq experiments, but not in single cell sequencing experiments).

-   PC1 will be the x axis and differences in PC1 are responsible for the most variance in the data set.
    The percent of variation accounted for in PC1 will be specified in the axis label.
    PC2 is the y axis and PC2 is responsible for the second most variance.
    The percent of variation here will also be included in the axis label.

-   PCA has a few major limitations.

    -   You cannot say for certain what factor or combinations of factors are contributing to the variance.
        However, you do get very clear insight into overall similarity and differences between samples.

    -   Inclusion of a group of samples that are vastly different than the rest will limit the information you can glean from a PCA plot.
        If the difference between naive samples and any treatment condition is more significant than any other differences, then you will not be able to see other differences present.
        To further interrogate your samples I recommend removing samples like naive from your data set and running the PCA analysis on that.
        This will let you see what groupings emerge without something like naive driving \~80% of the variance.

    -   For a PCA plot to really give good information, you would hope to see the principal components account for \~50-60% of the total variance.
        Ideally, PC1 would account for \~30+% of the variance.

: PCA function inputs

[**Change the title and if you want to label the dots change it to TRUE**]{style="color: red"}

```{r PCA_analysis, eval=TRUE}
# run the function
pca_data <- DESeq2::plotPCA(rlog_norm,
    intgroup = "Group", returnData = TRUE
)
# get the percent variation of the PCA data so that we can add that to the plot
percent_variation <- round(100 * attr(pca_data, "percentVar"))
labs <- plot_aes$labels
outlines <- plot_aes$outlineID
fills <- plot_aes$fillID
shapes <- plot_aes$shapeID

pca_plot <-
    ggplot2::ggplot(pca_data, ggplot2::aes(x = PC1, y = PC2, color = Group, shape = Group, fill = Group)) +
    ggplot2::geom_point(size = 3.5, stroke = 2.25) +
    ggplot2::geom_point(size = 3.5, stroke = 2) +
    ggplot2::scale_color_manual(labels = labs, values = outlines, name = "Group: ") +
    ggplot2::scale_fill_manual(labels = labs, values = fills, name = "Group: ") +
    ggplot2::scale_shape_manual(labels = labs, values = shapes, name = "Group: ") +
    ggplot2::xlab(paste0("PC1: ", percent_variation[1], "% variance")) +
    ggplot2::ylab(paste0("PC2: ", percent_variation[2], "% variance")) +
    ggplot2::labs(title = plot_title)
pca_plot + analyzeRNA::global_theme()

export_genelist(pca_data, "martinPCAdata")
analyzeRNA::pca_analysis(
    dseq_transform = rlog_norm,
    plot_aes = plot_aes,
    plot_title = "PCA",
    label_samples = TRUE
)
library(PCAtools)
rlog_pca <- dplyr::select(rlog_df, -c(MGI_Desc))
rlog_pca <- remove_rownames(rlog_pca)
rlog_pca <- distinct(rlog_pca, MGI_Symbol, .keep_all = TRUE)
rlog_pca <- dplyr::filter(rlog_pca, MGI_Symbol != "")
rlog_pca <- column_to_rownames(rlog_pca, "MGI_Symbol")
p <- pca(rlog_pca, meta, removeVar = 0)
screeplot(p)
biplot(p, showLoadings = TRUE, ntopLoadings = 10)
pairsplot(p, components = getComponents(p, seq_len(4)), colby = "Group", colkey = c(Butyrate = "black", Control = "#359435"), pointSize = 3, shape = "Group", shapekey = c(Control = 15, Butyrate = 15), triangle = FALSE)
plotloadings(p)
```

## UMAP

-   UMAP is another dimensionality reduction technique.
    UMAP is better suited for a much higher number of samples (single cell vs bulk).
    Odds are you won't really use UMAP for anything here but I already wrote the code so I'm not getting rid of it.
    UMAP, unlike PCA does not provide you with the numerical amount of variance accounted for.

-   *Warning:* Every time the UMAP function is (re)run, the resulting plot will be different.
    This is due to "randomness" inherent in the UMAP algorithm.
    Either take steps to force reproducible results, or be cautious when re-running UMAP function.

    -   The result of the UMAP function is saved as an object so the plot can be displayed without re-calculating UMAP.
        It does not incorporate "true randomness" since computers are not capable of this.
        Functions achieve "pseudorandomness" by setting a number called a seed which changes every time the function is run.
        This number is generated using the system clock of the computer.

    -   The results can be forced to be reproducible by adding `batch = TRUE` to the umap() call, and by adding `set.seed(x)` where `x` is an integer you choose.

[**you can change the seed around, play with the neighbors and m Dist, change the title and toggle labels**]{style="color: red"}

```{r umapAnalysis, eval=FALSE}
set.seed(5)
rlogUMAP <- analyzeRNA::umap_analysis(
    dseq_transform = rlog_norm,
    neighbors = 3,
    m_dist = 0.5,
    cond_list = sample_labels,
    plot_aes = plot_aes,
    plot_title = "rlog Normalized UMAP",
    batch = TRUE,
    label_samples = FALSE
)

rlogUMAP
```

## Volcano Plot

-   A volcano plot will show all of the genes in the pairwise comparison results

    -   the X axis on the volcano plot is the Log2 Fold Change for each gene
    -   the Y axis is the -Log10 Adjusted P value for each gene
    -   a horizontal and vertical line will be added to the plot to indicate the threshold for significance for fold change and p value respectively

-   the plot will label significant genes with their MGI symbol (not all genes may be labeled if there are too many to plot without crowding the plot)

-   the function takes as input:

    -   results data frame for pairwise comparison, this should be annotated already, use the full data frame, not the one that has been filtered for significant genes already

    -   plot title string

    -   2 strings indicating the names of the conditions in the pairwise comparison.
        they should be in order so that the numerator for the DEG results is listed before the denominator

    -   *optional* change the threshold values as specified above

    -   *optional*

        : Volcano plots inputs

```{r volcano_plots, eval=TRUE}
analyzeRNA::volcano_plot(
    deg_df = butyrate_vs_control,
    plotTitle = "Butyrate vs. Control",
    cond1 = "Butyrate", cond2 = "Control",
    l2fc_cutoff = 0.5, pval_cutoff = 0.05,
    dircolors = c("black", "#2c902c", "gray85")
) + ggplot2::theme(legend.position = "none") + ggplot2::labs(subtitle = NULL)
```

```{r down_in_but}
# get only the genes downregulate in butyrate
down_in_butyrate <- dplyr::filter(butyrate_vs_control, Log2FoldChange < 0)
up_in_butyrate <- dplyr::filter(butyrate_vs_control, Log2FoldChange > 0)
down_butyrate_signif <- analyzeRNA::signif_deg(down_in_butyrate, padj_cutoff = 0.05, l2fc_cutoff = 0.4, entrezid = FALSE)
up_butyrate_signif <- analyzeRNA::signif_deg(up_in_butyrate, padj_cutoff = 0.05, l2fc_cutoff = 0.4, entrezid = FALSE)
```

## Gene Ontology Based Analysis

[The code here was adapted from this page.](https://hbctraining.github.io/DGE_workshop/lessons/09_functional_analysis.html)

Some info on GO terms generally: [GO Terms Overview website](https://geneontology.org/docs/ontology-documentation/ "Click for background info on GO terms generally"){.uri}

GO terms are organized into "Biological Processes" (BP), "Molecular Functions" (MF), and "Cellular Components" (CC).
You can do GSEA analysis on just one of these or a combination of them.

These analyses will use pairwise comparison results, not the rlog normalized counts.

### Over-representation Analysis

```{r gsea_and_oe, eval=TRUE}
OE <- go_ORA(butyrate_vs_control, l2fc_cutoff = 0.4, pval_cutoff = 0.05, ontol = "ALL")
GSE <- go_GSEA(butyrate_vs_control, pval_cutoff = 0.05, ontol = "ALL")
bvc_FCs <- getFoldChanges(butyrate_vs_control)
bvc_sig <- getFoldChanges(ranked_Butyrate_vs_Control)

OE_results <- OE@result
GSE_results <- GSE@result

export_genelist(OE_results, "overexpressionresults")
export_genelist(GSE_results, "gsearesults")

down_butyrate_OE <- go_ORA(down_in_butyrate, l2fc_cutoff = 0.45, pval_cutoff = 0.05)
down_butyrate_GSE <- go_GSEA(down_in_butyrate, pval_cutoff = 0.05)
down_butyrate_FCs <- getFoldChanges(down_in_butyrate)
down_butyrate_sig <- getFoldChanges(down_butyrate_signif)

up_butyrate_OE <- go_ORA(up_in_butyrate, l2fc_cutoff = 0.45, pval_cutoff = 0.05)
up_butyrate_GSE <- go_GSEA(up_in_butyrate, pval_cutoff = 0.05)
up_butyrate_bvc_FCs <- getFoldChanges(up_in_butyrate)
up_butyrate_bvc_sig <- getFoldChanges(up_butyrate_signif)
```

### Gene Set Enrichment Analysis (GSEA)

The dotplot shows the number of genes associated with the first 50 terms (size) and the p-adjusted values for these terms (color).
This plot displays the top 50 genes by gene ratio (\# genes related to GO term / total number of sig genes), not p-adjusted value.

```{r gsea_plots, eval=FALSE, fig.height=8, fig.width=12.5}
gseplot <- makeGSEplot(
    GSE_obj = GSE,
    plot_title = "Butyrate vs. Control GSEA",
    plot_type = "dot",
    categories_to_show = 25,
    label_length = 85,
    fontsize = 11.5
)
gseplot


oe_dot <- makeGSEplot(
    GSE_obj = OE,
    plot_title = "Butyrate vs Control Overexpression Analysis - Molecular Functions",
    plot_type = "dot",
    categories_to_show = 15,
    label_length = 85,
    fontsize = 11.5
)
oe_dot
```

## Heatmaps

This code chunk will create a heatmap of the most significantly changed genes across all samples and their expression in each sample.
This visualization can easily show the effects of treatments on different genes.
It also will cluster genes.
Gene sets gotten from GSEA

```{r heatmaps}
filterset <- dplyr::filter(butyrate_vs_control, Adj_P_Value <= 0.25, abs(Log2FoldChange) >= 0.5)
filterset <- dplyr::select(filterset, MGI_Symbol)
heatmapgenes <- dplyr::filter(rlog_df, MGI_Symbol %in% filterset$MGI_Symbol)

oxphos_heatmap <- heatmapFromCSV(
    plottitle = "Oxidative Phosphorlyation Genes",
    fname = paste(cwd, "GOgenesets/oxphos.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

oxphos_heatmap

etc_heatmap <- heatmapFromCSV(
    plottitle = "Electron Transport Chain Genes",
    fname = paste(cwd, "GOgenesets/etc.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

etc_heatmap

cellprocess_heatmap <- heatmapFromCSV(
    plottitle = "Cellular Process Genes",
    fname = paste(cwd,
        "GOgenesets/cellularprocesses.csv",
        sep = "/"
    ),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 5
)

cellprocess_heatmap
```

```{r testing}
go_groups <- bind_rows(
    goGrouping(butyrate_vs_control, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 3),
    goGrouping(butyrate_vs_control, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 4),
    goGrouping(butyrate_vs_control, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 5),
    goGrouping(butyrate_vs_control, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 6),
    goGrouping(butyrate_vs_control, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 3, ontol = "MF"),
    goGrouping(butyrate_vs_control, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 4, ontol = "MF"),
    goGrouping(butyrate_vs_control, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 5, ontol = "MF"),
    goGrouping(butyrate_vs_control, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 6, ontol = "MF")
) %>%
    dplyr::filter(Count > 3) %>%
    dplyr::distinct(ID, .keep_all = TRUE)

analyzeRNA::export_genelist(go_groups, "all_gogroups")



downgroups <- bind_rows(
    goGrouping(down_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 3),
    goGrouping(down_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 4),
    goGrouping(down_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 5),
    goGrouping(down_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 6),
    goGrouping(down_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 3, ontol = "MF"),
    goGrouping(down_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 4, ontol = "MF"),
    goGrouping(down_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 5, ontol = "MF"),
    goGrouping(down_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 6, ontol = "MF")
) %>%
    dplyr::filter(Count > 3) %>%
    dplyr::distinct(ID, .keep_all = TRUE)

analyzeRNA::export_genelist(downgroups, "downinbutyrate_gogroups")

upgroups <- bind_rows(
    goGrouping(up_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 3),
    goGrouping(up_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 4),
    goGrouping(up_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 5),
    goGrouping(up_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 6),
    goGrouping(up_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 3, ontol = "MF"),
    goGrouping(up_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 4, ontol = "MF"),
    goGrouping(up_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 5, ontol = "MF"),
    goGrouping(up_in_butyrate, pval_cutoff = 0.05, l2fc_cutoff = 0.4, lvl = 6, ontol = "MF")
) %>%
    dplyr::filter(Count > 3) %>%
    dplyr::distinct(ID, .keep_all = TRUE)

analyzeRNA::export_genelist(upgroups, "upinbutyrate_gogroups")

getgenelistfromgogroup <- function(gogroup, rownum) {
    gogroup <- dplyr::slice(gogroup, rownum)
    allgenes <- gogroup$geneID
    listgenes <- stringr::str_split(allgenes, "/")
    listgenes <- listgenes[[1]]
    listgenes <- as.data.frame(listgenes)
    listgenes <- dplyr::rename(listgenes, MGI_Symbol = listgenes)
    return(listgenes)
}
cellproc <- getgenelistfromgogroup(go_groups2, 1)
heatmapFromDF("Cellular Processes GO Group", cellproc, meta, rlog_df, anno_colors, gaps = c(5), height = 8)

bioreg <- getgenelistfromgogroup(go_groups2, 3)
heatmapFromDF("Regulation of Biological Processes GO Group", bioreg, meta, rlog_df, anno_colors, gaps = c(5), height = 8)


downhf <- getgenelistfromgogroup(downgroup, 3)
heatmapFromDF("Downregulated in Butyrate - Regulation of Cellular Processes", downhf, meta, rlog_df, anno_colors, gaps = c(5))
```

Code adapted from <http://revigo.irb.hr/>

```{r revigo_plots}
gsea_BP_revigo.names <- c("term_ID", "description", "frequency", "value", "uniqueness", "dispensability", "representative")
gsea_BP_revigo.data <- rbind(
    c("GO:0015980", "energy derivation by oxidation of organic compounds", 1.308850321219676, 2.345094282541393, 0.16343444529447088, 0, "energy derivation by oxidation of organic compounds"),
    c("GO:0006091", "generation of precursor metabolites and energy", 1.5965097324767474, 2.2683288958732546, 0.6948281775554409, 0.17787051, "energy derivation by oxidation of organic compounds"),
    c("GO:0015986", "proton motive force-driven ATP synthesis", 0.3260139994246812, 1.523167550124369, 0.729679215721972, 0.14978751, "energy derivation by oxidation of organic compounds")
)
gsea_BP <- data.frame(gsea_BP_revigo.data)
names(gsea_BP) <- gsea_BP_revigo.names
gsea_BP$value <- as.numeric(as.character(gsea_BP$value))
gsea_BP$frequency <- as.numeric(as.character(gsea_BP$frequency))
gsea_BP$uniqueness <- as.numeric(as.character(gsea_BP$uniqueness))
gsea_BP$dispensability <- as.numeric(as.character(gsea_BP$dispensability))
# check the tmPlot command documentation for all possible parameters - there are a lot more
treemap(
    gsea_BP,
    index = c("representative", "description"),
    vSize = "value",
    type = "categorical",
    vColor = "representative",
    title = "Gene Set Enrichment Analysis - Biological Processes",
    inflate.labels = FALSE, # set this to TRUE for space-filling group labels - good for posters
    lowerbound.cex.labels = 0, # try to draw as many labels as possible (still, some small squares may not get a label)
    bg.labels = "#CCCCCCAA", # define background color of group labels
    # "#CCCCCC00" is fully transparent, "#CCCCCCAA" is semi-transparent grey, NA is opaque
    position.legend = "none", fontsize.labels = 16, fontsize.title = 30
)


GSEA_MF_revigo.names <- c("term_ID", "description", "frequency", "value", "uniqueness", "dispensability", "representative")
GSEA_MF_revigo.data <- rbind(
    c("GO:0005215", "transporter activity", 5.851609436819225, 2.6239539730153325, 1, -0, "transporter activity"),
    c("GO:0015399", "primary active transmembrane transporter activity", 0.7277878181018903, 2.774020535023139, 0.45163823264815417, 0, "primary active transmembrane transporter activity"),
    c("GO:0022804", "active transmembrane transporter activity", 2.100327260294046, 2.34747138195882, 0.41665542318284915, 0.63117221, "primary active transmembrane transporter activity"),
    c("GO:0016491", "oxidoreductase activity", 3.819664924534753, 2.2683288958732546, 1, -0, "oxidoreductase activity")
)
GSEA_MF <- data.frame(GSEA_MF_revigo.data)
names(GSEA_MF) <- GSEA_MF_revigo.names
GSEA_MF$value <- as.numeric(as.character(GSEA_MF$value))
GSEA_MF$frequency <- as.numeric(as.character(GSEA_MF$frequency))
GSEA_MF$uniqueness <- as.numeric(as.character(GSEA_MF$uniqueness))
GSEA_MF$dispensability <- as.numeric(as.character(GSEA_MF$dispensability))
# check the tmPlot command documentation for all possible parameters - there are a lot more
treemap(
    GSEA_MF,
    index = c("representative", "description"),
    vSize = "value",
    type = "categorical",
    vColor = "representative",
    title = "Gene Set Enrichment Analysis - Molecular Functions",
    inflate.labels = FALSE, # set this to TRUE for space-filling group labels - good for posters
    lowerbound.cex.labels = 0, # try to draw as many labels as possible (still, some small squares may not get a label)
    bg.labels = "#CCCCCCAA", # define background color of group labels
    # "#CCCCCC00" is fully transparent, "#CCCCCCAA" is semi-transparent grey, NA is opaque
    position.legend = "none", fontsize.labels = 16, fontsize.title = 30
)



OE_BP_revigo.names <- c("term_ID", "description", "frequency", "value", "uniqueness", "dispensability", "representative")
OE_BP_revigo.data <- rbind(
    c("GO:0009060", "aerobic respiration", 0.791063380956947, 3.6538231265784296, 0.5784520851197481, 0, "aerobic respiration"),
    c("GO:0006091", "generation of precursor metabolites and energy", 1.5965097324767474, 2.873336201953369, 0.6851456473328003, 0.16789351, "aerobic respiration"),
    c("GO:0019637", "organophosphate metabolic process", 4.209416051395149, 1.5026990091445855, 0.3078770031161236, 0.21565848, "aerobic respiration"),
    c("GO:0044281", "small molecule metabolic process", 7.925016780132323, 1.5293007124953633, 0.7471765878804134, 0.12992639, "aerobic respiration"),
    c("GO:0055086", "nucleobase-containing small molecule metabolic process", 2.6464665835650587, 1.388303026539609, 0.33483938664103563, 0.35600705, "aerobic respiration"),
    c("GO:0072521", "purine-containing compound metabolic process", 2.1910058490746955, 1.5293007124953633, 0.533040434224178, 0.18938585, "aerobic respiration"),
    c("GO:0072522", "purine-containing compound biosynthetic process", 1.0595454981302137, 1.5293007124953633, 0.3569577763593333, 0.31706367, "aerobic respiration"),
    c("GO:1901293", "nucleoside phosphate biosynthetic process", 1.2177581743216033, 1.5293007124953633, 0.1497369514304732, 0.58474398, "aerobic respiration")
)

oe_bp <- data.frame(OE_BP_revigo.data)
names(oe_bp) <- OE_BP_revigo.names
oe_bp$value <- as.numeric(as.character(oe_bp$value))
oe_bp$frequency <- as.numeric(as.character(oe_bp$frequency))
oe_bp$uniqueness <- as.numeric(as.character(oe_bp$uniqueness))
oe_bp$dispensability <- as.numeric(as.character(oe_bp$dispensability))
# check the tmPlot command documentation for all possible parameters - there are a lot more
treemap(
    oe_bp,
    index = c("representative", "description"),
    vSize = "value",
    type = "categorical",
    vColor = "representative",
    title = "Overexpression Analysis - Biological Processes",
    inflate.labels = FALSE, # set this to TRUE for space-filling group labels - good for posters
    lowerbound.cex.labels = 0, # try to draw as many labels as possible (still, some small squares may not get a label)
    bg.labels = "#CCCCCCAA", # define background color of group labels
    # "#CCCCCC00" is fully transparent, "#CCCCCCAA" is semi-transparent grey, NA is opaque
    position.legend = "none",
    fontsize.labels = 16, fontsize.title = 30
)



OE_MF_revigo.names <- c("term_ID", "description", "frequency", "value", "uniqueness", "dispensability", "representative")
OE_MF_revigo.data <- rbind(
    c("GO:0005215", "transporter activity", 5.851609436819225, 1.7309669126474507, 1, -0, "transporter activity"),
    c("GO:0015399", "primary active transmembrane transporter activity", 0.7277878181018903, 3.3982549863646327, 0.45163823264815417, 0, "primary active transmembrane transporter activity"),
    c("GO:0022804", "active transmembrane transporter activity", 2.100327260294046, 2.878909828515169, 0.41665542318284915, 0.63117221, "primary active transmembrane transporter activity"),
    c("GO:0016491", "oxidoreductase activity", 3.819664924534753, 2.878909828515169, 1, -0, "oxidoreductase activity")
)
oe_mf <- data.frame(OE_MF_revigo.data)
names(oe_mf) <- OE_MF_revigo.names
oe_mf$value <- as.numeric(as.character(oe_mf$value))
oe_mf$frequency <- as.numeric(as.character(oe_mf$frequency))
oe_mf$uniqueness <- as.numeric(as.character(oe_mf$uniqueness))
oe_mf$dispensability <- as.numeric(as.character(oe_mf$dispensability))
# check the tmPlot command documentation for all possible parameters - there are a lot more
treemap(
    oe_mf,
    index = c("representative", "description"),
    vSize = "value",
    type = "categorical",
    vColor = "representative",
    title = "Overexpression Analysis - Molecular Functions",
    inflate.labels = FALSE, # set this to TRUE for space-filling group labels - good for posters
    lowerbound.cex.labels = 0, # try to draw as many labels as possible (still, some small squares may not get a label)
    bg.labels = "#CCCCCCAA", # define background color of group labels
    # "#CCCCCC00" is fully transparent, "#CCCCCCAA" is semi-transparent grey, NA is opaque
    position.legend = "none", fontsize.labels = 16, fontsize.title = 30
)



downButyrate_MF_revigo.names <- c("term_ID", "description", "frequency", "value", "uniqueness", "dispensability", "representative")
downButyrate_MF_revigo.data <- rbind(
    c("GO:0003676", "nucleic acid binding", 16.65119914033117, 6, 0.8145944079446459, 0.08693156, "nucleic acid binding"),
    c("GO:0003677", "DNA binding", 11.327113759585796, 4, 0.8244018380522029, 0.48101478, "nucleic acid binding"),
    c("GO:0005515", "protein binding", 46.046011820446445, 14, 0.8549808133268876, 0, "protein binding"),
    c("GO:0043167", "ion binding", 29.184779954085872, 9, 0.8740675215394087, 0.11123734, "protein binding"),
    c("GO:0097159", "organic cyclic compound binding", 27.431250915840376, 8, 0.8764353074642292, 0.10790592, "protein binding"),
    c("GO:1901363", "heterocyclic compound binding", 27.020954427782932, 8, 0.877000793947717, 0.10712564, "protein binding"),
    c("GO:0016787", "hydrolase activity", 11.927905045669906, 4, 1, -0, "hydrolase activity"),
    c("GO:0019899", "enzyme binding", 11.439456845601525, 5, 0.903105270571926, 0.07584481, "enzyme binding"),
    c("GO:0030234", "enzyme regulator activity", 6.423093830899234, 5, 1, -0, "enzyme regulator activity"),
    c("GO:0046872", "metal ion binding", 20.168026180823524, 7, 0.799314715107492, 0.09394052, "metal ion binding"),
    c("GO:0043169", "cation binding", 20.66135886289259, 7, 0.7985693263098219, 0.54884331, "metal ion binding")
)
downButyrate_MF <- data.frame(downButyrate_MF_revigo.data)
names(downButyrate_MF) <- downButyrate_MF_revigo.names
downButyrate_MF$value <- as.numeric(as.character(downButyrate_MF$value))
downButyrate_MF$frequency <- as.numeric(as.character(downButyrate_MF$frequency))
downButyrate_MF$uniqueness <- as.numeric(as.character(downButyrate_MF$uniqueness))
downButyrate_MF$dispensability <- as.numeric(as.character(downButyrate_MF$dispensability))
# check the tmPlot command documentation for all possible parameters - there are a lot more
treemap(
    downButyrate_MF,
    index = c("representative", "description"),
    vSize = "value",
    type = "categorical",
    vColor = "representative",
    title = "Molecular Functions - Genes downregulated in Butyrate",
    inflate.labels = FALSE, # set this to TRUE for space-filling group labels - good for posters
    lowerbound.cex.labels = 0, # try to draw as many labels as possible (still, some small squares may not get a label)
    bg.labels = "#CCCCCCAA", # define background color of group labels
    # "#CCCCCC00" is fully transparent, "#CCCCCCAA" is semi-transparent grey, NA is opaque
    position.legend = "none", fontsize.labels = 16, fontsize.title = 30
)


downButyrate_BP_revigo.names <- c("term_ID", "description", "frequency", "value", "uniqueness", "dispensability", "representative")
downButyrate_BP_revigo.data <- rbind(
    c("GO:0002252", "immune effector process", 1.8793748202128682, 4, 1, -0, "immune effector process"),
    c("GO:0006915", "apoptotic process", 5.086777255729217, 5, 0.976135320861736, 0.02653926, "apoptotic process"),
    c("GO:0007154", "cell communication", 29.23099050723943, 10, 0.9802955748054369, 0.02573982, "cell communication"),
    c("GO:0007267", "cell-cell signaling", 4.453926550963659, 4, 0.918872656014912, 0.06047122, "cell-cell signaling"),
    c("GO:0007165", "signal transduction", 27.063956275769492, 8, 0.8389140907287884, 0.40901526, "cell-cell signaling"),
    c("GO:0035556", "intracellular signal transduction", 7.397641192827692, 5, 0.8815970889846814, 0.46207725, "cell-cell signaling"),
    c("GO:0008219", "cell death", 5.465528813884361, 5, 0.9866974468482281, 0.02700001, "cell death"),
    c("GO:0008283", "cell population proliferation", 4.252564963083709, 5, 0.987312551119928, -0, "cell population proliferation"),
    c("GO:0009611", "response to wounding", 2.0663534375299646, 4, 0.972698050991124, -0, "response to wounding"),
    c("GO:0006950", "response to stress", 16.727394764598717, 10, 0.9701649974160312, 0.31169328, "response to wounding"),
    c("GO:0006952", "defense response", 7.095598811007767, 5, 0.9668371174184909, 0.57197496, "response to wounding"),
    c("GO:0009605", "response to external stimulus", 12.498801419119761, 5, 0.9721391042648377, 0.28247043, "response to wounding"),
    c("GO:0010033", "response to organic substance", 14.608303768338288, 6, 0.9640996169505319, 0.52861326, "response to wounding"),
    c("GO:0033554", "cellular response to stress", 7.723655192252374, 6, 0.9493500641103316, 0.46240818, "response to wounding"),
    c("GO:0042221", "response to chemical", 24.508581839102504, 8, 0.9671762337886729, 0.36059094, "response to wounding"),
    c("GO:0051716", "cellular response to stimulus", 35.7464761722121, 12, 0.9453194127360558, 0.17888588, "response to wounding"),
    c("GO:0070887", "cellular response to chemical stimulus", 12.33579441940742, 8, 0.9477401572416421, 0.28128244, "response to wounding"),
    c("GO:0071310", "cellular response to organic substance", 9.205101160226292, 5, 0.9508341746097834, 0.4740964, "response to wounding"),
    c("GO:0010629", "negative regulation of gene expression", 4.871032697286413, 6, 0.7974905506990622, -0, "negative regulation of gene expression"),
    c("GO:0001817", "regulation of cytokine production", 3.988877169431393, 4, 0.8336229834396136, 0.35161919, "negative regulation of gene expression"),
    c("GO:0002682", "regulation of immune system process", 7.661328986480008, 4, 0.9300196859207535, 0.11893737, "negative regulation of gene expression"),
    c("GO:0006417", "regulation of translation", 2.2101831431585004, 4, 0.8262833083308322, 0.3212403, "negative regulation of gene expression"),
    c("GO:0009889", "regulation of biosynthetic process", 20.08342122926455, 11, 0.7903797469748018, 0.53768124, "negative regulation of gene expression"),
    c("GO:0009890", "negative regulation of biosynthetic process", 8.30856266180842, 6, 0.7675912710867051, 0.69601646, "negative regulation of gene expression"),
    c("GO:0009891", "positive regulation of biosynthetic process", 10.288618275961262, 8, 0.759350020450373, 0.65580068, "negative regulation of gene expression"),
    c("GO:0009892", "negative regulation of metabolic process", 15.130885032121968, 9, 0.7851569256393054, 0.57419402, "negative regulation of gene expression"),
    c("GO:0010468", "regulation of gene expression", 23.717518458145555, 11, 0.7739433246698125, 0.57163315, "negative regulation of gene expression"),
    c("GO:0010628", "positive regulation of gene expression", 6.141528430338479, 5, 0.7926629837830617, 0.56977276, "negative regulation of gene expression"),
    c("GO:0010646", "regulation of cell communication", 16.837664205580595, 6, 0.9083305760898128, 0.1591174, "negative regulation of gene expression"),
    c("GO:0019219", "regulation of nucleobase-containing compound metabolic process", 19.071818966343848, 8, 0.7689049338274546, 0.59750931, "negative regulation of gene expression"),
    c("GO:0019222", "regulation of metabolic process", 32.68290344232429, 14, 0.8978316415202555, 0.2223991, "negative regulation of gene expression"),
    c("GO:0023051", "regulation of signaling", 16.828075558538693, 6, 0.9156593510784921, 0.15907853, "negative regulation of gene expression"),
    c("GO:0023052", "signaling", 28.339246332342505, 10, 0.902282859955296, 0.20487945, "negative regulation of gene expression"),
    c("GO:0031323", "regulation of cellular metabolic process", 26.2968645124173, 12, 0.7710628409835814, 0.5949521, "negative regulation of gene expression"),
    c("GO:0031325", "positive regulation of cellular metabolic process", 14.824048326781092, 10, 0.7450318528359707, 0.55506764, "negative regulation of gene expression"),
    c("GO:0031326", "regulation of cellular biosynthetic process", 19.43139323041519, 11, 0.7509262394363724, 0.53141776, "negative regulation of gene expression"),
    c("GO:0031327", "negative regulation of cellular biosynthetic process", 7.996931632946591, 6, 0.7526761795652376, 0.69028643, "negative regulation of gene expression"),
    c("GO:0031328", "positive regulation of cellular biosynthetic process", 9.948221305973727, 8, 0.7461779862788771, 0.65020926, "negative regulation of gene expression"),
    c("GO:0032879", "regulation of localization", 11.424872950426696, 7, 0.9234088090276661, 0.13641925, "negative regulation of gene expression"),
    c("GO:0034248", "regulation of amide metabolic process", 2.5074312014574742, 4, 0.8545969948514043, 0.22446167, "negative regulation of gene expression"),
    c("GO:0042981", "regulation of apoptotic process", 7.809953015629495, 5, 0.9235424117513051, 0.11967474, "negative regulation of gene expression"),
    c("GO:0043067", "regulation of programmed cell death", 8.064052162239909, 5, 0.9230114365690542, 0.12092402, "negative regulation of gene expression"),
    c("GO:0048518", "positive regulation of biological process", 31.450762297439834, 13, 0.8990712320809511, 0.21738964, "negative regulation of gene expression"),
    c("GO:0048519", "negative regulation of biological process", 27.001630069997123, 11, 0.9037038080172968, 0.19954966, "negative regulation of gene expression"),
    c("GO:0048523", "negative regulation of cellular process", 23.679163869977945, 10, 0.8433709278143143, 0.42835227, "negative regulation of gene expression"),
    c("GO:0048583", "regulation of response to stimulus", 19.460159171540894, 7, 0.9123205550894489, 0.16965306, "negative regulation of gene expression"),
    c("GO:0048584", "positive regulation of response to stimulus", 11.146802186211525, 4, 0.8571577854089467, 0.56383034, "negative regulation of gene expression"),
    c("GO:0048585", "negative regulation of response to stimulus", 8.35650589701793, 5, 0.8656883677451656, 0.48729029, "negative regulation of gene expression"),
    c("GO:0050789", "regulation of biological process", 61.65500047943235, 17, 0.8853109295859335, 0.3172118, "negative regulation of gene expression"),
    c("GO:0050793", "regulation of developmental process", 12.997411065298687, 7, 0.9209946574906522, 0.14321227, "negative regulation of gene expression"),
    c("GO:0050794", "regulation of cellular process", 57.73324383929428, 16, 0.8752090000908146, 0.10385441, "negative regulation of gene expression"),
    c("GO:0051128", "regulation of cellular component organization", 12.637836801227348, 4, 0.914682783774912, 0.14167747, "negative regulation of gene expression"),
    c("GO:0051171", "regulation of nitrogen compound metabolic process", 27.476268098571293, 13, 0.7720308986085112, 0.60544837, "negative regulation of gene expression"),
    c("GO:0051172", "negative regulation of nitrogen compound metabolic process", 12.033752037587496, 9, 0.7590827290971365, 0.62369962, "negative regulation of gene expression"),
    c("GO:0051239", "regulation of multicellular organismal process", 15.78291303097133, 8, 0.9170513731007741, 0.15482058, "negative regulation of gene expression"),
    c("GO:0051240", "positive regulation of multicellular organismal process", 9.018122542909197, 5, 0.867962436055983, 0.55258121, "negative regulation of gene expression"),
    c("GO:0051246", "regulation of protein metabolic process", 12.637836801227348, 10, 0.7976289362886909, 0.46136502, "negative regulation of gene expression"),
    c("GO:0051248", "negative regulation of protein metabolic process", 5.144309137980631, 7, 0.7881074579699572, 0.6303951, "negative regulation of gene expression"),
    c("GO:0051252", "regulation of RNA metabolic process", 17.681465145268003, 8, 0.7585118389451123, 0.58409214, "negative regulation of gene expression"),
    c("GO:0051254", "positive regulation of RNA metabolic process", 9.094831719244414, 6, 0.7530098039055368, 0.69111892, "negative regulation of gene expression"),
    c("GO:0060255", "regulation of macromolecule metabolic process", 30.27135871128584, 14, 0.7657108864682017, 0.35705439, "negative regulation of gene expression"),
    c("GO:0060341", "regulation of cellular localization", 5.297727490651069, 5, 0.9218994527929436, 0.10635521, "negative regulation of gene expression"),
    c("GO:0065008", "regulation of biological quality", 15.174033943810528, 9, 0.9265857370608149, 0.13456895, "negative regulation of gene expression"),
    c("GO:0065009", "regulation of molecular function", 12.613865183622591, 5, 0.9298917959212257, 0.12507673, "negative regulation of gene expression"),
    c("GO:0080090", "regulation of primary metabolic process", 28.449515773324386, 13, 0.7697982395862801, 0.61404326, "negative regulation of gene expression"),
    c("GO:0080134", "regulation of response to stress", 7.177102310863937, 4, 0.9148789595036986, 0.5153138, "negative regulation of gene expression"),
    c("GO:0016043", "cellular component organization", 26.598906894237224, 9, 0.9571226027573561, 0.04372711, "cellular component organization"),
    c("GO:0006996", "organelle organization", 14.512417297919264, 5, 0.9619502983752769, 0.57229611, "cellular component organization"),
    c("GO:0022607", "cellular component assembly", 11.228305686067696, 4, 0.9639317025286114, 0.53047588, "cellular component organization"),
    c("GO:0043933", "protein-containing complex organization", 9.176335219100585, 5, 0.9653729017706361, 0.50164209, "cellular component organization"),
    c("GO:0044085", "cellular component biogenesis", 12.431680889826445, 5, 0.9636108117334214, 0.54631759, "cellular component organization"),
    c("GO:0016477", "cell migration", 4.463515198005561, 4, 0.9871983906213887, 0.01782219, "cell migration"),
    c("GO:0032940", "secretion by cell", 2.0903250551347208, 4, 0.9185854241347413, 0.01589774, "secretion by cell"),
    c("GO:0006886", "intracellular protein transport", 3.240962700163007, 4, 0.8947786791006956, 0.39894033, "secretion by cell"),
    c("GO:0033036", "macromolecule localization", 11.640617508869498, 7, 0.9121673968575083, 0.57353027, "secretion by cell"),
    c("GO:0046903", "secretion", 2.708792789337424, 4, 0.9247899076452096, 0.38265188, "secretion by cell"),
    c("GO:0051234", "establishment of localization", 18.860868731421995, 9, 0.9032883138502905, 0.64862188, "secretion by cell"),
    c("GO:0051641", "cellular localization", 13.29465912359766, 9, 0.8968460707032812, 0.4389023, "secretion by cell"),
    c("GO:0070727", "cellular macromolecule localization", 9.540703806692875, 7, 0.8860436391460785, 0.6576745, "secretion by cell"),
    c("GO:0071702", "organic substance transport", 10.609837951864993, 7, 0.9052567928034226, 0.5610509, "secretion by cell"),
    c("GO:0071705", "nitrogen compound transport", 7.714066545210471, 6, 0.9106209336596671, 0.58427242, "secretion by cell"),
    c("GO:0140352", "export from cell", 2.401956083996548, 4, 0.9168716940540419, 0.36959667, "secretion by cell"),
    c("GO:0043086", "negative regulation of catalytic activity", 3.240962700163007, 4, 0.934838594101848, 0.05079158, "negative regulation of catalytic activity"),
    c("GO:0044092", "negative regulation of molecular function", 5.024451049956851, 4, 0.9297816269191468, 0.66815471, "negative regulation of catalytic activity"),
    c("GO:0050790", "regulation of catalytic activity", 8.850321219675903, 4, 0.9220302681474635, 0.61811221, "negative regulation of catalytic activity"),
    c("GO:0043603", "amide metabolic process", 3.7587496404257363, 6, 0.9091895706981498, 0, "amide metabolic process"),
    c("GO:0006139", "nucleobase-containing compound metabolic process", 18.606769584811584, 9, 0.8091580993185586, 0.46595017, "amide metabolic process"),
    c("GO:0006518", "peptide metabolic process", 2.4115447310384504, 5, 0.8866000884846759, 0.18191613, "amide metabolic process"),
    c("GO:0006725", "cellular aromatic compound metabolic process", 19.62796049477419, 9, 0.8460655610726904, 0.47377608, "amide metabolic process"),
    c("GO:0006793", "phosphorus metabolic process", 8.811966631508295, 4, 0.8723603189218523, 0.30939881, "amide metabolic process"),
    c("GO:0006796", "phosphate-containing compound metabolic process", 8.696902867005466, 4, 0.8727169232360272, 0.28803616, "amide metabolic process"),
    c("GO:0006807", "nitrogen compound metabolic process", 36.59986575894141, 15, 0.8599068209419738, 0.50710783, "amide metabolic process"),
    c("GO:0009056", "catabolic process", 9.569469747818584, 7, 0.9019036750472385, 0.2965598, "amide metabolic process"),
    c("GO:0009058", "biosynthetic process", 18.247195320740246, 12, 0.8853636172980833, 0.37059155, "amide metabolic process"),
    c("GO:0010467", "gene expression", 8.461981014478857, 11, 0.8912487304226354, 0.28568445, "amide metabolic process"),
    c("GO:0019538", "protein metabolic process", 18.625946878895387, 11, 0.8524468136042909, 0.41061671, "amide metabolic process"),
    c("GO:0034641", "cellular nitrogen compound metabolic process", 21.162144021478568, 10, 0.8377053981107163, 0.42442538, "amide metabolic process"),
    c("GO:0036211", "protein modification process", 11.985808802377985, 4, 0.8659534905153019, 0.58378744, "amide metabolic process"),
    c("GO:0043170", "macromolecule metabolic process", 32.80755585386902, 14, 0.8594164191025953, 0.47935684, "amide metabolic process"),
    c("GO:0043412", "macromolecule modification", 12.8583756831911, 4, 0.8806134584040702, 0.33130143, "amide metabolic process"),
    c("GO:0044237", "cellular metabolic process", 32.65893182471953, 15, 0.8524625692689755, 0.47827043, "amide metabolic process"),
    c("GO:0044238", "primary metabolic process", 39.42851663630262, 15, 0.8565338568377268, 0.52790723, "amide metabolic process"),
    c("GO:0044248", "cellular catabolic process", 5.125131843896826, 6, 0.8788431196488945, 0.24852844, "amide metabolic process"),
    c("GO:0044281", "small molecule metabolic process", 7.925016780132323, 5, 0.9058621089622175, 0.28020728, "amide metabolic process"),
    c("GO:0046483", "heterocycle metabolic process", 19.31632946591236, 9, 0.8466963470087958, 0.47140447, "amide metabolic process"),
    c("GO:0071704", "organic substance metabolic process", 41.29830280947358, 16, 0.8543612879390283, 0.23002827, "amide metabolic process"),
    c("GO:1901360", "organic cyclic compound metabolic process", 20.76900949276057, 9, 0.8767002994145109, 0.39012419, "amide metabolic process"),
    c("GO:1901564", "organonitrogen compound metabolic process", 23.45862498801419, 13, 0.8614551681340573, 0.41047645, "amide metabolic process"),
    c("GO:1901566", "organonitrogen compound biosynthetic process", 6.280563812446063, 5, 0.8489710551348412, 0.61998783, "amide metabolic process"),
    c("GO:1901576", "organic substance biosynthetic process", 17.930769968357467, 12, 0.8257695510634148, 0.36810104, "amide metabolic process"),
    c("GO:0045597", "positive regulation of cell differentiation", 4.7367916386997795, 4, 0.8708445239830115, 0.06108447, "positive regulation of cell differentiation"),
    c("GO:0009893", "positive regulation of metabolic process", 19.11017355451146, 10, 0.7682208823998028, 0.54236273, "positive regulation of cell differentiation"),
    c("GO:0009966", "regulation of signal transduction", 14.560360533128774, 4, 0.8808406286250231, 0.68376768, "positive regulation of cell differentiation"),
    c("GO:0010647", "positive regulation of cell communication", 8.994150925304439, 4, 0.8655617863987591, 0.43121913, "positive regulation of cell differentiation"),
    c("GO:0023056", "positive regulation of signaling", 8.994150925304439, 4, 0.8729013370731912, 0.43121913, "positive regulation of cell differentiation"),
    c("GO:0048522", "positive regulation of cellular process", 28.109118803336848, 13, 0.8348963033095765, 0.36719708, "positive regulation of cell differentiation"),
    c("GO:0051094", "positive regulation of developmental process", 7.229839869594399, 5, 0.867313610703889, 0.68281566, "positive regulation of cell differentiation"),
    c("GO:2000026", "regulation of multicellular organismal development", 7.6325630453543, 5, 0.8978876473424241, 0.63146299, "positive regulation of cell differentiation"),
    c("GO:0048870", "cell motility", 5.283344520088216, 4, 0.9867840449524742, 0.02678053, "cell motility"),
    c("GO:0071840", "cellular component organization or biogenesis", 27.62009780419983, 9, 0.9806104214642649, 0.04438172, "cellular component organization or biogenesis"),
    c("GO:0072359", "circulatory system development", 4.832678109118803, 4, 0.9418057696528934, -0, "circulatory system development"),
    c("GO:0001816", "cytokine production", 0.08629782337712148, 4, 0.9355182481811825, 0.11983909, "circulatory system development"),
    c("GO:0007275", "multicellular organism development", 19.771790200402723, 10, 0.9267819685017048, 0.60671149, "circulatory system development"),
    c("GO:0007399", "nervous system development", 10.542717422571675, 4, 0.9325067340832067, 0.65188787, "circulatory system development"),
    c("GO:0009653", "anatomical structure morphogenesis", 11.415284303384793, 7, 0.9367606267109848, 0.5115544, "circulatory system development"),
    c("GO:0009888", "tissue development", 9.219484130789146, 4, 0.9395555324871524, 0.48214443, "circulatory system development"),
    c("GO:0030097", "hemopoiesis", 3.840253140281906, 4, 0.9338251108834781, 0.31179694, "circulatory system development"),
    c("GO:0030154", "cell differentiation", 18.822514143254388, 8, 0.9128443437474446, 0.5967682, "circulatory system development"),
    c("GO:0048513", "animal organ development", 15.231565826061944, 6, 0.9325889625546899, 0.55746179, "circulatory system development"),
    c("GO:0048646", "anatomical structure formation involved in morphogenesis", 4.962124844184486, 4, 0.9464726764923629, 0.32504256, "circulatory system development"),
    c("GO:0048731", "system development", 17.55201841020232, 8, 0.9254013881489461, 0.58319272, "circulatory system development"),
    c("GO:0048856", "anatomical structure development", 26.392750982836322, 11, 0.9278710430473801, 0.41325111, "circulatory system development"),
    c("GO:0048869", "cellular developmental process", 18.99510979000863, 8, 0.9174548936509438, 0.59858814, "circulatory system development")
)
downButyrate_BP <- data.frame(downButyrate_BP_revigo.data)
names(downButyrate_BP) <- downButyrate_BP_revigo.names
downButyrate_BP$value <- as.numeric(as.character(downButyrate_BP$value))
downButyrate_BP$frequency <- as.numeric(as.character(downButyrate_BP$frequency))
downButyrate_BP$uniqueness <- as.numeric(as.character(downButyrate_BP$uniqueness))
downButyrate_BP$dispensability <- as.numeric(as.character(downButyrate_BP$dispensability))
# check the tmPlot command documentation for all possible parameters - there are a lot more
treemap(
    downButyrate_BP,
    index = c("representative", "description"),
    vSize = "value",
    type = "categorical",
    vColor = "representative",
    title = "Biological Processes - Genes downregulated in Butyrate",
    inflate.labels = FALSE, # set this to TRUE for space-filling group labels - good for posters
    lowerbound.cex.labels = 0, # try to draw as many labels as possible (still, some small squares may not get a label)
    bg.labels = "#CCCCCCAA", # define background color of group labels
    # "#CCCCCC00" is fully transparent, "#CCCCCCAA" is semi-transparent grey, NA is opaque
    position.legend = "none", fontsize.title = 30, fontsize.labels = 16
)



gogroups_BP_revigo.names <- c("term_ID", "description", "frequency", "value", "uniqueness", "dispensability", "representative")
gogroups_BP_revigo.data <- rbind(
    c("GO:0002252", "immune effector process", 1.8793748202128682, 4, 1, -0, "immune effector process"),
    c("GO:0006915", "apoptotic process", 5.086777255729217, 5, 0.9760094406749784, 0.02618654, "apoptotic process"),
    c("GO:0007005", "mitochondrion organization", 2.3300412311822805, 5, 0.9686728721279236, 0.0161235, "mitochondrion organization"),
    c("GO:0006996", "organelle organization", 14.512417297919264, 10, 0.9566286322837831, 0.57229611, "mitochondrion organization"),
    c("GO:0016043", "cellular component organization", 26.598906894237224, 15, 0.9514961796853021, 0.3663789, "mitochondrion organization"),
    c("GO:0022607", "cellular component assembly", 11.228305686067696, 9, 0.9555245979751599, 0.53047588, "mitochondrion organization"),
    c("GO:0043933", "protein-containing complex organization", 9.176335219100585, 10, 0.9603788165077359, 0.50164209, "mitochondrion organization"),
    c("GO:0044085", "cellular component biogenesis", 12.431680889826445, 10, 0.9586255164384734, 0.54631759, "mitochondrion organization"),
    c("GO:0007154", "cell communication", 29.23099050723943, 10, 0.9780446542212758, 0.04438172, "cell communication"),
    c("GO:0007267", "cell-cell signaling", 4.453926550963659, 4, 0.9272253305799297, 0.06047122, "cell-cell signaling"),
    c("GO:0007165", "signal transduction", 27.063956275769492, 8, 0.8558450580643313, 0.40901526, "cell-cell signaling"),
    c("GO:0035556", "intracellular signal transduction", 7.397641192827692, 5, 0.8936882431323064, 0.46207725, "cell-cell signaling"),
    c("GO:0008219", "cell death", 5.465528813884361, 5, 0.9847453051416378, 0.02663502, "cell death"),
    c("GO:0008283", "cell population proliferation", 4.252564963083709, 6, 0.9854059609453959, 0.01765705, "cell population proliferation"),
    c("GO:0009611", "response to wounding", 2.0663534375299646, 4, 0.9759036949070646, -0, "response to wounding"),
    c("GO:0006950", "response to stress", 16.727394764598717, 13, 0.9731172085055885, 0.31169328, "response to wounding"),
    c("GO:0006952", "defense response", 7.095598811007767, 5, 0.9706890730829535, 0.57197496, "response to wounding"),
    c("GO:0009605", "response to external stimulus", 12.498801419119761, 5, 0.9748933677538759, 0.28247043, "response to wounding"),
    c("GO:0010033", "response to organic substance", 14.608303768338288, 8, 0.9653379125214822, 0.52861326, "response to wounding"),
    c("GO:0033554", "cellular response to stress", 7.723655192252374, 7, 0.9517401372312921, 0.46240818, "response to wounding"),
    c("GO:0042221", "response to chemical", 24.508581839102504, 11, 0.9704244340762158, 0.36059094, "response to wounding"),
    c("GO:0051716", "cellular response to stimulus", 35.7464761722121, 13, 0.9462654846608757, 0.17888588, "response to wounding"),
    c("GO:0070887", "cellular response to chemical stimulus", 12.33579441940742, 8, 0.9472223221355012, 0.28128244, "response to wounding"),
    c("GO:0071310", "cellular response to organic substance", 9.205101160226292, 5, 0.9502904047619345, 0.4740964, "response to wounding"),
    c("GO:1901700", "response to oxygen-containing compound", 8.87429283728066, 5, 0.9686972297389355, 0.47025304, "response to wounding"),
    c("GO:0010629", "negative regulation of gene expression", 4.871032697286413, 6, 0.8272936669263009, -0, "negative regulation of gene expression"),
    c("GO:0001817", "regulation of cytokine production", 3.988877169431393, 4, 0.8579169158623673, 0.35161919, "negative regulation of gene expression"),
    c("GO:0002682", "regulation of immune system process", 7.661328986480008, 4, 0.9403866129924374, 0.11893737, "negative regulation of gene expression"),
    c("GO:0006417", "regulation of translation", 2.2101831431585004, 4, 0.8514481727824705, 0.3212403, "negative regulation of gene expression"),
    c("GO:0009889", "regulation of biosynthetic process", 20.08342122926455, 12, 0.8208022615246466, 0.53768124, "negative regulation of gene expression"),
    c("GO:0009890", "negative regulation of biosynthetic process", 8.30856266180842, 6, 0.8019073995902396, 0.69601646, "negative regulation of gene expression"),
    c("GO:0009891", "positive regulation of biosynthetic process", 10.288618275961262, 8, 0.7948032695345948, 0.65580068, "negative regulation of gene expression"),
    c("GO:0009892", "negative regulation of metabolic process", 15.130885032121968, 9, 0.8165345314230473, 0.57419402, "negative regulation of gene expression"),
    c("GO:0010468", "regulation of gene expression", 23.717518458145555, 12, 0.8065043317855606, 0.57163315, "negative regulation of gene expression"),
    c("GO:0010628", "positive regulation of gene expression", 6.141528430338479, 5, 0.8231081758796215, 0.56977276, "negative regulation of gene expression"),
    c("GO:0010646", "regulation of cell communication", 16.837664205580595, 6, 0.9216722795756433, 0.1591174, "negative regulation of gene expression"),
    c("GO:0019219", "regulation of nucleobase-containing compound metabolic process", 19.071818966343848, 9, 0.8017095990789065, 0.59750931, "negative regulation of gene expression"),
    c("GO:0019222", "regulation of metabolic process", 32.68290344232429, 15, 0.9130015160966892, 0.2223991, "negative regulation of gene expression"),
    c("GO:0023051", "regulation of signaling", 16.828075558538693, 6, 0.9281694048870072, 0.15907853, "negative regulation of gene expression"),
    c("GO:0023052", "signaling", 28.339246332342505, 10, 0.91678892550434, 0.20487945, "negative regulation of gene expression"),
    c("GO:0031323", "regulation of cellular metabolic process", 26.2968645124173, 13, 0.8040233240383515, 0.5949521, "negative regulation of gene expression"),
    c("GO:0031325", "positive regulation of cellular metabolic process", 14.824048326781092, 10, 0.7815832462050097, 0.55506764, "negative regulation of gene expression"),
    c("GO:0031326", "regulation of cellular biosynthetic process", 19.43139323041519, 12, 0.7864107543495868, 0.53141776, "negative regulation of gene expression"),
    c("GO:0031327", "negative regulation of cellular biosynthetic process", 7.996931632946591, 6, 0.7884653600093062, 0.69028643, "negative regulation of gene expression"),
    c("GO:0031328", "positive regulation of cellular biosynthetic process", 9.948221305973727, 8, 0.782808977523348, 0.65020926, "negative regulation of gene expression"),
    c("GO:0032879", "regulation of localization", 11.424872950426696, 7, 0.9347622465474088, 0.13641925, "negative regulation of gene expression"),
    c("GO:0034248", "regulation of amide metabolic process", 2.5074312014574742, 4, 0.87551803189036, 0.23646171, "negative regulation of gene expression"),
    c("GO:0042127", "regulation of cell population proliferation", 8.706491514047368, 4, 0.9330883116523815, 0.12402362, "negative regulation of gene expression"),
    c("GO:0042981", "regulation of apoptotic process", 7.809953015629495, 5, 0.934652632198408, 0.11967474, "negative regulation of gene expression"),
    c("GO:0043067", "regulation of programmed cell death", 8.064052162239909, 5, 0.934199518272603, 0.12092402, "negative regulation of gene expression"),
    c("GO:0048518", "positive regulation of biological process", 31.450762297439834, 14, 0.9140562762945196, 0.21738964, "negative regulation of gene expression"),
    c("GO:0048519", "negative regulation of biological process", 27.001630069997123, 11, 0.9179979124127361, 0.19954966, "negative regulation of gene expression"),
    c("GO:0048523", "negative regulation of cellular process", 23.679163869977945, 10, 0.8669433506430945, 0.42835227, "negative regulation of gene expression"),
    c("GO:0048583", "regulation of response to stimulus", 19.460159171540894, 7, 0.9253289162590628, 0.16965306, "negative regulation of gene expression"),
    c("GO:0048584", "positive regulation of response to stimulus", 11.146802186211525, 4, 0.8791518368040488, 0.56383034, "negative regulation of gene expression"),
    c("GO:0048585", "negative regulation of response to stimulus", 8.35650589701793, 5, 0.8864005352711354, 0.48729029, "negative regulation of gene expression"),
    c("GO:0050789", "regulation of biological process", 61.65500047943235, 18, 0.9024190496078407, 0.3172118, "negative regulation of gene expression"),
    c("GO:0050793", "regulation of developmental process", 12.997411065298687, 7, 0.9327084008894087, 0.14321227, "negative regulation of gene expression"),
    c("GO:0050794", "regulation of cellular process", 57.73324383929428, 17, 0.8937445403333866, 0.10385441, "negative regulation of gene expression"),
    c("GO:0051128", "regulation of cellular component organization", 12.637836801227348, 5, 0.9270925016580062, 0.14167747, "negative regulation of gene expression"),
    c("GO:0051171", "regulation of nitrogen compound metabolic process", 27.476268098571293, 14, 0.8050360181680221, 0.60544837, "negative regulation of gene expression"),
    c("GO:0051172", "negative regulation of nitrogen compound metabolic process", 12.033752037587496, 9, 0.7939905703028063, 0.62369962, "negative regulation of gene expression"),
    c("GO:0051239", "regulation of multicellular organismal process", 15.78291303097133, 8, 0.9293536637131796, 0.15482058, "negative regulation of gene expression"),
    c("GO:0051240", "positive regulation of multicellular organismal process", 9.018122542909197, 5, 0.8882971508565707, 0.55258121, "negative regulation of gene expression"),
    c("GO:0051246", "regulation of protein metabolic process", 12.637836801227348, 10, 0.8266732391622412, 0.46136502, "negative regulation of gene expression"),
    c("GO:0051248", "negative regulation of protein metabolic process", 5.144309137980631, 7, 0.8190615531833957, 0.6303951, "negative regulation of gene expression"),
    c("GO:0051252", "regulation of RNA metabolic process", 17.681465145268003, 9, 0.7918808838716183, 0.58409214, "negative regulation of gene expression"),
    c("GO:0051254", "positive regulation of RNA metabolic process", 9.094831719244414, 6, 0.7875074185748006, 0.69111892, "negative regulation of gene expression"),
    c("GO:0060255", "regulation of macromolecule metabolic process", 30.27135871128584, 15, 0.7996001273997932, 0.35705439, "negative regulation of gene expression"),
    c("GO:0060341", "regulation of cellular localization", 5.297727490651069, 5, 0.933377517810243, 0.10635521, "negative regulation of gene expression"),
    c("GO:0065008", "regulation of biological quality", 15.174033943810528, 10, 0.9375073636896477, 0.13456895, "negative regulation of gene expression"),
    c("GO:0065009", "regulation of molecular function", 12.613865183622591, 5, 0.9403175158359934, 0.12507673, "negative regulation of gene expression"),
    c("GO:0080090", "regulation of primary metabolic process", 28.449515773324386, 14, 0.8031160232516142, 0.61404326, "negative regulation of gene expression"),
    c("GO:0080134", "regulation of response to stress", 7.177102310863937, 4, 0.9277293700340721, 0.5153138, "negative regulation of gene expression"),
    c("GO:1903311", "regulation of mRNA metabolic process", 1.4430913798063094, 4, 0.8693494552465952, 0.22953354, "negative regulation of gene expression"),
    c("GO:0016477", "cell migration", 4.463515198005561, 4, 0.9852830904278926, 0.01782219, "cell migration"),
    c("GO:0019637", "organophosphate metabolic process", 4.209416051395149, 8, 0.8278923035355767, 0, "organophosphate metabolic process"),
    c("GO:0006091", "generation of precursor metabolites and energy", 1.5965097324767474, 8, 0.8862853457307847, 0.2063138, "organophosphate metabolic process"),
    c("GO:0006139", "nucleobase-containing compound metabolic process", 18.606769584811584, 15, 0.7753416348875991, 0.4993297, "organophosphate metabolic process"),
    c("GO:0006163", "purine nucleotide metabolic process", 2.027998849362355, 7, 0.7859060213365653, 0.62695216, "organophosphate metabolic process"),
    c("GO:0006518", "peptide metabolic process", 2.4115447310384504, 5, 0.873431103509055, 0.29415325, "organophosphate metabolic process"),
    c("GO:0006725", "cellular aromatic compound metabolic process", 19.62796049477419, 15, 0.8213746749895117, 0.47377608, "organophosphate metabolic process"),
    c("GO:0006793", "phosphorus metabolic process", 8.811966631508295, 9, 0.8491098330870526, 0.28917875, "organophosphate metabolic process"),
    c("GO:0006807", "nitrogen compound metabolic process", 36.59986575894141, 22, 0.8457086917395003, 0.50710783, "organophosphate metabolic process"),
    c("GO:0009056", "catabolic process", 9.569469747818584, 8, 0.888280670209469, 0.2965598, "organophosphate metabolic process"),
    c("GO:0009057", "macromolecule catabolic process", 4.942947550100681, 4, 0.8784919860359026, 0.1707205, "organophosphate metabolic process"),
    c("GO:0009058", "biosynthetic process", 18.247195320740246, 18, 0.8712718815802759, 0.37059155, "organophosphate metabolic process"),
    c("GO:0010467", "gene expression", 8.461981014478857, 12, 0.8773775262612962, 0.28568445, "organophosphate metabolic process"),
    c("GO:0015980", "energy derivation by oxidation of organic compounds", 1.308850321219676, 8, 0.8696768296626197, 0.20085148, "organophosphate metabolic process"),
    c("GO:0019538", "protein metabolic process", 18.625946878895387, 12, 0.8331239927053116, 0.41061671, "organophosphate metabolic process"),
    c("GO:0034641", "cellular nitrogen compound metabolic process", 21.162144021478568, 16, 0.8138565723552803, 0.42442538, "organophosphate metabolic process"),
    c("GO:0036211", "protein modification process", 11.985808802377985, 5, 0.8473627713700544, 0.58378744, "organophosphate metabolic process"),
    c("GO:0043170", "macromolecule metabolic process", 32.80755585386902, 16, 0.8437344343289249, 0.47935684, "organophosphate metabolic process"),
    c("GO:0043412", "macromolecule modification", 12.8583756831911, 5, 0.8664026512512857, 0.33130143, "organophosphate metabolic process"),
    c("GO:0043603", "amide metabolic process", 3.7587496404257363, 6, 0.894485397496801, 0.14857771, "organophosphate metabolic process"),
    c("GO:0044237", "cellular metabolic process", 32.65893182471953, 23, 0.8385947398671325, 0.47827043, "organophosphate metabolic process"),
    c("GO:0044238", "primary metabolic process", 39.42851663630262, 22, 0.8423648285955041, 0.52790723, "organophosphate metabolic process"),
    c("GO:0044281", "small molecule metabolic process", 7.925016780132323, 10, 0.8924072968851376, 0.28020728, "organophosphate metabolic process"),
    c("GO:0046483", "heterocycle metabolic process", 19.31632946591236, 15, 0.8220312417888641, 0.47140447, "organophosphate metabolic process"),
    c("GO:0055086", "nucleobase-containing small molecule metabolic process", 2.6464665835650587, 7, 0.827342926872674, 0.35600705, "organophosphate metabolic process"),
    c("GO:0071704", "organic substance metabolic process", 41.29830280947358, 23, 0.8402148945203617, 0.24621693, "organophosphate metabolic process"),
    c("GO:0072521", "purine-containing compound metabolic process", 2.1910058490746955, 7, 0.8409523943672986, 0.21565848, "organophosphate metabolic process"),
    c("GO:1901135", "carbohydrate derivative metabolic process", 4.62172787419695, 7, 0.8980777007883987, 0.16632718, "organophosphate metabolic process"),
    c("GO:1901137", "carbohydrate derivative biosynthetic process", 2.7855019656726436, 6, 0.8469903516860109, 0.1538478, "organophosphate metabolic process"),
    c("GO:1901360", "organic cyclic compound metabolic process", 20.76900949276057, 15, 0.8611738033385317, 0.39012419, "organophosphate metabolic process"),
    c("GO:1901564", "organonitrogen compound metabolic process", 23.45862498801419, 19, 0.844284647996043, 0.41047645, "organophosphate metabolic process"),
    c("GO:1901566", "organonitrogen compound biosynthetic process", 6.280563812446063, 10, 0.8280404109518872, 0.61998783, "organophosphate metabolic process"),
    c("GO:1901576", "organic substance biosynthetic process", 17.930769968357467, 18, 0.8067141158863675, 0.52486945, "organophosphate metabolic process"),
    c("GO:0034220", "monoatomic ion transmembrane transport", 3.9936714929523442, 6, 0.8711262127792745, 0.01748344, "monoatomic ion transmembrane transport"),
    c("GO:0006810", "transport", 18.036245085818393, 12, 0.8736073321549868, 0.57029688, "monoatomic ion transmembrane transport"),
    c("GO:0006811", "monoatomic ion transport", 4.813500815034998, 6, 0.8980072582137599, 0.44893458, "monoatomic ion transmembrane transport"),
    c("GO:0006886", "intracellular protein transport", 3.240962700163007, 4, 0.8783616826599511, 0.42223016, "monoatomic ion transmembrane transport"),
    c("GO:0032940", "secretion by cell", 2.0903250551347208, 4, 0.9000007338210908, 0.39610695, "monoatomic ion transmembrane transport"),
    c("GO:0033036", "macromolecule localization", 11.640617508869498, 7, 0.893909513022432, 0.61881064, "monoatomic ion transmembrane transport"),
    c("GO:0046903", "secretion", 2.708792789337424, 4, 0.9066661203838432, 0.41114027, "monoatomic ion transmembrane transport"),
    c("GO:0051641", "cellular localization", 13.29465912359766, 9, 0.8770740419479441, 0.64084905, "monoatomic ion transmembrane transport"),
    c("GO:0055085", "transmembrane transport", 6.141528430338479, 6, 0.881784236426738, 0.60115539, "monoatomic ion transmembrane transport"),
    c("GO:0070727", "cellular macromolecule localization", 9.540703806692875, 7, 0.8702834072118764, 0.6576745, "monoatomic ion transmembrane transport"),
    c("GO:0071702", "organic substance transport", 10.609837951864993, 7, 0.8832147639561003, 0.68422969, "monoatomic ion transmembrane transport"),
    c("GO:0071705", "nitrogen compound transport", 7.714066545210471, 6, 0.8896459049354482, 0.63321372, "monoatomic ion transmembrane transport"),
    c("GO:0140352", "export from cell", 2.401956083996548, 4, 0.8979702606611305, 0.40402778, "monoatomic ion transmembrane transport"),
    c("GO:0043086", "negative regulation of catalytic activity", 3.240962700163007, 4, 0.9447040953313389, 0.05079158, "negative regulation of catalytic activity"),
    c("GO:0044092", "negative regulation of molecular function", 5.024451049956851, 4, 0.9404070341681573, 0.66815471, "negative regulation of catalytic activity"),
    c("GO:0050790", "regulation of catalytic activity", 8.850321219675903, 4, 0.9338172808840505, 0.61811221, "negative regulation of catalytic activity"),
    c("GO:0045597", "positive regulation of cell differentiation", 4.7367916386997795, 4, 0.8905726616164554, 0.06108447, "positive regulation of cell differentiation"),
    c("GO:0009893", "positive regulation of metabolic process", 19.11017355451146, 10, 0.8020263405508955, 0.54236273, "positive regulation of cell differentiation"),
    c("GO:0009966", "regulation of signal transduction", 14.560360533128774, 4, 0.8986626115701983, 0.68376768, "positive regulation of cell differentiation"),
    c("GO:0010647", "positive regulation of cell communication", 8.994150925304439, 4, 0.8859669137627109, 0.43121913, "positive regulation of cell differentiation"),
    c("GO:0023056", "positive regulation of signaling", 8.994150925304439, 4, 0.8924521430693162, 0.43121913, "positive regulation of cell differentiation"),
    c("GO:0048522", "positive regulation of cellular process", 28.109118803336848, 14, 0.8597199419873961, 0.36719708, "positive regulation of cell differentiation"),
    c("GO:0051094", "positive regulation of developmental process", 7.229839869594399, 5, 0.8877991256587344, 0.68281566, "positive regulation of cell differentiation"),
    c("GO:2000026", "regulation of multicellular organismal development", 7.6325630453543, 5, 0.9134743727840049, 0.63146299, "positive regulation of cell differentiation"),
    c("GO:0048870", "cell motility", 5.283344520088216, 4, 0.9848381130601438, 0.02642141, "cell motility"),
    c("GO:0071840", "cellular component organization or biogenesis", 27.62009780419983, 15, 0.9783678502799458, 0.0254079, "cellular component organization or biogenesis"),
    c("GO:0072359", "circulatory system development", 4.832678109118803, 4, 0.9514787405397156, -0, "circulatory system development"),
    c("GO:0001816", "cytokine production", 0.08629782337712148, 4, 0.9272725544924242, 0.11983909, "circulatory system development"),
    c("GO:0007275", "multicellular organism development", 19.771790200402723, 10, 0.9389109835185312, 0.60671149, "circulatory system development"),
    c("GO:0007399", "nervous system development", 10.542717422571675, 4, 0.9437019472881037, 0.65188787, "circulatory system development"),
    c("GO:0009653", "anatomical structure morphogenesis", 11.415284303384793, 7, 0.947260310239208, 0.5115544, "circulatory system development"),
    c("GO:0009888", "tissue development", 9.219484130789146, 4, 0.9495974759064081, 0.48214443, "circulatory system development"),
    c("GO:0030097", "hemopoiesis", 3.840253140281906, 4, 0.9409171181688739, 0.31179694, "circulatory system development"),
    c("GO:0030154", "cell differentiation", 18.822514143254388, 8, 0.9222757076897735, 0.5967682, "circulatory system development"),
    c("GO:0048513", "animal organ development", 15.231565826061944, 6, 0.943770744352665, 0.55746179, "circulatory system development"),
    c("GO:0048646", "anatomical structure formation involved in morphogenesis", 4.962124844184486, 4, 0.9553791778105517, 0.32504256, "circulatory system development"),
    c("GO:0048731", "system development", 17.55201841020232, 8, 0.9377552142633268, 0.58319272, "circulatory system development"),
    c("GO:0048856", "anatomical structure development", 26.392750982836322, 11, 0.939822609705018, 0.41325111, "circulatory system development"),
    c("GO:0048869", "cellular developmental process", 18.99510979000863, 8, 0.9261208867746838, 0.59858814, "circulatory system development")
)
gogroups_BP <- data.frame(gogroups_BP_revigo.data)
names(gogroups_BP) <- gogroups_BP_revigo.names
gogroups_BP$value <- as.numeric(as.character(gogroups_BP$value))
gogroups_BP$frequency <- as.numeric(as.character(gogroups_BP$frequency))
gogroups_BP$uniqueness <- as.numeric(as.character(gogroups_BP$uniqueness))
gogroups_BP$dispensability <- as.numeric(as.character(gogroups_BP$dispensability))
# check the tmPlot command documentation for all possible parameters - there are a lot more
treemap(
    gogroups_BP,
    index = c("representative", "description"),
    vSize = "value",
    type = "categorical",
    vColor = "representative",
    title = "GO Groups - Biological Processes",
    inflate.labels = FALSE, # set this to TRUE for space-filling group labels - good for posters
    lowerbound.cex.labels = 0, # try to draw as many labels as possible (still, some small squares may not get a label)
    bg.labels = "#CCCCCCAA", # define background color of group labels
    # "#CCCCCC00" is fully transparent, "#CCCCCCAA" is semi-transparent grey, NA is opaque
    position.legend = "none", fontsize.title = 30, fontsize.labels = 14
)


gogroups_MF_revigo.names <- c("term_ID", "description", "frequency", "value", "uniqueness", "dispensability", "representative")
gogroups_MF_revigo.data <- rbind(
    c("GO:0003676", "nucleic acid binding", 16.65119914033117, 6, 0.9154974322558719, 0.08693156, "nucleic acid binding"),
    c("GO:0003677", "DNA binding", 11.327113759585796, 4, 0.9203856458055073, 0.48101478, "nucleic acid binding"),
    c("GO:0005515", "protein binding", 46.046011820446445, 17, 0.9273651381637713, 0.05518478, "protein binding"),
    c("GO:0043167", "ion binding", 29.184779954085872, 12, 0.9366832471026274, 0.11123734, "protein binding"),
    c("GO:0097159", "organic cyclic compound binding", 27.431250915840376, 9, 0.9378259381341537, 0.10790592, "protein binding"),
    c("GO:1901363", "heterocyclic compound binding", 27.020954427782932, 9, 0.9380987154912359, 0.10712564, "protein binding"),
    c("GO:0016491", "oxidoreductase activity", 3.819664924534753, 8, 0.8563477282895087, 0, "oxidoreductase activity"),
    c("GO:0009055", "electron transfer activity", 0.27841547403897815, 7, 0.7236337238573278, 0.20240142, "oxidoreductase activity"),
    c("GO:0016651", "oxidoreductase activity, acting on NAD(P)H", 0.3516827040492356, 5, 0.7415025890109835, 0.54452804, "oxidoreductase activity"),
    c("GO:0016655", "oxidoreductase activity, acting on NAD(P)H, quinone or similar compound as acceptor", 0.18072583402530162, 5, 0.6595277147044148, 0.51481281, "oxidoreductase activity"),
    c("GO:0016787", "hydrolase activity", 11.927905045669906, 4, 0.8381464761853364, 0.43068303, "oxidoreductase activity"),
    c("GO:0140096", "catalytic activity, acting on a protein", 11.380843061593318, 4, 0.8389048541459487, 0.34050203, "oxidoreductase activity"),
    c("GO:0019901", "protein kinase binding", 3.8001269965320175, 4, 0.912584029455138, -0, "protein kinase binding"),
    c("GO:0019899", "enzyme binding", 11.439456845601525, 7, 0.9343043480530805, 0.15388399, "protein kinase binding"),
    c("GO:0019900", "kinase binding", 4.254383822595614, 4, 0.9115820411244716, 0.59747201, "protein kinase binding"),
    c("GO:0022804", "active transmembrane transporter activity", 2.100327260294046, 7, 0.8244297112138071, -0, "active transmembrane transporter activity"),
    c("GO:0015399", "primary active transmembrane transporter activity", 0.7277878181018903, 7, 0.8147236266290047, 0.63117221, "active transmembrane transporter activity"),
    c("GO:0015453", "oxidoreduction-driven active transmembrane transporter activity", 0.18561031602598543, 7, 0.8204822958757955, 0.67461202, "active transmembrane transporter activity"),
    c("GO:0030234", "enzyme regulator activity", 6.423093830899234, 5, 1, -0, "enzyme regulator activity"),
    c("GO:0044877", "protein-containing complex binding", 10.467444927465444, 5, 0.9517305216125398, 0.07362385, "protein-containing complex binding"),
    c("GO:0046872", "metal ion binding", 20.168026180823524, 10, 0.8738451469384954, 0.09394052, "metal ion binding"),
    c("GO:0043169", "cation binding", 20.66135886289259, 10, 0.884934886856661, 0.54884331, "metal ion binding"),
    c("GO:0046914", "transition metal ion binding", 5.255702632735798, 4, 0.8986836880011292, 0.55030337, "metal ion binding")
)
gogroups_MF <- data.frame(gogroups_MF_revigo.data)
names(gogroups_MF) <- gogroups_MF_revigo.names
gogroups_MF$value <- as.numeric(as.character(gogroups_MF$value))
gogroups_MF$frequency <- as.numeric(as.character(gogroups_MF$frequency))
gogroups_MF$uniqueness <- as.numeric(as.character(gogroups_MF$uniqueness))
gogroups_MF$dispensability <- as.numeric(as.character(gogroups_MF$dispensability))
# check the tmPlot command documentation for all possible parameters - there are a lot more
treemap(
    gogroups_MF,
    index = c("representative", "description"),
    vSize = "value",
    type = "categorical",
    vColor = "representative",
    title = "GO Grouping - Molecular Functions",
    inflate.labels = FALSE, # set this to TRUE for space-filling group labels - good for posters
    lowerbound.cex.labels = 0, # try to draw as many labels as possible (still, some small squares may not get a label)
    bg.labels = "#CCCCCCAA", # define background color of group labels
    # "#CCCCCC00" is fully transparent, "#CCCCCCAA" is semi-transparent grey, NA is opaque
    position.legend = "none", fontsize.title = 30, fontsize.labels = 16
)


upButyrate_MF_revigo.names <- c("term_ID", "description", "frequency", "value", "uniqueness", "dispensability", "representative")
upButyrate_MF_revigo.data <- rbind(
    c("GO:0016491", "oxidoreductase activity", 3.819664924534753, 7, 0.7727233007459892, -0, "oxidoreductase activity"),
    c("GO:0009055", "electron transfer activity", 0.27841547403897815, 7, 0.4561162600590458, 0.20240142, "oxidoreductase activity"),
    c("GO:0016651", "oxidoreductase activity, acting on NAD(P)H", 0.3516827040492356, 5, 0.49314322771285773, 0.54452804, "oxidoreductase activity"),
    c("GO:0016655", "oxidoreductase activity, acting on NAD(P)H, quinone or similar compound as acceptor", 0.18072583402530162, 5, 0.3347700147257337, 0.51481281, "oxidoreductase activity"),
    c("GO:0022804", "active transmembrane transporter activity", 2.100327260294046, 7, 0.5992857293554893, 0, "active transmembrane transporter activity"),
    c("GO:0015399", "primary active transmembrane transporter activity", 0.7277878181018903, 7, 0.5790866033446603, 0.63117221, "active transmembrane transporter activity"),
    c("GO:0015453", "oxidoreduction-driven active transmembrane transporter activity", 0.18561031602598543, 7, 0.5910435164299321, 0.67461202, "active transmembrane transporter activity")
)
upButyrate_MF <- data.frame(upButyrate_MF_revigo.data)
names(upButyrate_MF) <- upButyrate_MF_revigo.names
upButyrate_MF$value <- as.numeric(as.character(upButyrate_MF$value))
upButyrate_MF$frequency <- as.numeric(as.character(upButyrate_MF$frequency))
upButyrate_MF$uniqueness <- as.numeric(as.character(upButyrate_MF$uniqueness))
upButyrate_MF$dispensability <- as.numeric(as.character(upButyrate_MF$dispensability))
# check the tmPlot command documentation for all possible parameters - there are a lot more
treemap(
    upButyrate_MF,
    index = c("representative", "description"),
    vSize = "value",
    type = "categorical",
    vColor = "representative",
    title = "Molecular Functions - Genes upregulated in Butyrate",
    inflate.labels = FALSE, # set this to TRUE for space-filling group labels - good for posters
    lowerbound.cex.labels = 0, # try to draw as many labels as possible (still, some small squares may not get a label)
    bg.labels = "#CCCCCCAA", # define background color of group labels
    # "#CCCCCC00" is fully transparent, "#CCCCCCAA" is semi-transparent grey, NA is opaque
    position.legend = "none", fontsize.title = 30, fontsize.labels = 16
)


upButyrate_BP_revigo.names <- c("term_ID", "description", "frequency", "value", "uniqueness", "dispensability", "representative")
upButyrate_BP_revigo.data <- rbind(
    c("GO:0006091", "generation of precursor metabolites and energy", 1.5965097324767474, 7, 0.7432846832978988, 0, "generation of precursor metabolites and energy"),
    c("GO:0006139", "nucleobase-containing compound metabolic process", 18.606769584811584, 6, 0.521851216229192, 0.4993297, "generation of precursor metabolites and energy"),
    c("GO:0006725", "cellular aromatic compound metabolic process", 19.62796049477419, 6, 0.6088817170388557, 0.47377608, "generation of precursor metabolites and energy"),
    c("GO:0006793", "phosphorus metabolic process", 8.811966631508295, 5, 0.6651548488473691, 0.3700122, "generation of precursor metabolites and energy"),
    c("GO:0006807", "nitrogen compound metabolic process", 36.59986575894141, 7, 0.6591161182734795, 0.50710783, "generation of precursor metabolites and energy"),
    c("GO:0009058", "biosynthetic process", 18.247195320740246, 6, 0.7124775708068357, 0.33975025, "generation of precursor metabolites and energy"),
    c("GO:0019637", "organophosphate metabolic process", 4.209416051395149, 5, 0.5886741522140906, 0.21565848, "generation of precursor metabolites and energy"),
    c("GO:0022904", "respiratory electron transport chain", 0.4890209991370218, 7, 0.7192049665721323, 0.15935542, "generation of precursor metabolites and energy"),
    c("GO:0034641", "cellular nitrogen compound metabolic process", 21.162144021478568, 6, 0.597912492089397, 0.47140447, "generation of precursor metabolites and energy"),
    c("GO:0044237", "cellular metabolic process", 32.65893182471953, 8, 0.6573278284678056, 0.22849122, "generation of precursor metabolites and energy"),
    c("GO:0044238", "primary metabolic process", 39.42851663630262, 7, 0.6522792521832587, 0.52790723, "generation of precursor metabolites and energy"),
    c("GO:0044281", "small molecule metabolic process", 7.925016780132323, 5, 0.7576810732382034, 0.26221003, "generation of precursor metabolites and energy"),
    c("GO:0046483", "heterocycle metabolic process", 19.31632946591236, 6, 0.6101919767590575, 0.34675108, "generation of precursor metabolites and energy"),
    c("GO:0055086", "nucleobase-containing small molecule metabolic process", 2.6464665835650587, 5, 0.6093733730921344, 0.35600705, "generation of precursor metabolites and energy"),
    c("GO:0071704", "organic substance metabolic process", 41.29830280947358, 7, 0.6479069751948614, 0.47827043, "generation of precursor metabolites and energy"),
    c("GO:0072521", "purine-containing compound metabolic process", 2.1910058490746955, 5, 0.6568343423156797, 0.18938585, "generation of precursor metabolites and energy"),
    c("GO:0072522", "purine-containing compound biosynthetic process", 1.0595454981302137, 5, 0.6258449190789592, 0.34706493, "generation of precursor metabolites and energy"),
    c("GO:0090407", "organophosphate biosynthetic process", 2.3875731134336946, 5, 0.5149081208712183, 0.6417776, "generation of precursor metabolites and energy"),
    c("GO:1901135", "carbohydrate derivative metabolic process", 4.62172787419695, 5, 0.771745191653354, 0.13286193, "generation of precursor metabolites and energy"),
    c("GO:1901137", "carbohydrate derivative biosynthetic process", 2.7855019656726436, 5, 0.6444168045879692, 0.15600798, "generation of precursor metabolites and energy"),
    c("GO:1901360", "organic cyclic compound metabolic process", 20.76900949276057, 6, 0.6937448893469751, 0.3560954, "generation of precursor metabolites and energy"),
    c("GO:1901564", "organonitrogen compound metabolic process", 23.45862498801419, 6, 0.6632667305052726, 0.37297521, "generation of precursor metabolites and energy"),
    c("GO:1901566", "organonitrogen compound biosynthetic process", 6.280563812446063, 5, 0.6288767496512078, 0.61998783, "generation of precursor metabolites and energy"),
    c("GO:1901576", "organic substance biosynthetic process", 17.930769968357467, 6, 0.576334584583689, 0.52486945, "generation of precursor metabolites and energy"),
    c("GO:0007005", "mitochondrion organization", 2.3300412311822805, 5, 0.9148015833305689, 0.01414395, "mitochondrion organization"),
    c("GO:0006996", "organelle organization", 14.512417297919264, 5, 0.8833555317224407, 0.57229611, "mitochondrion organization"),
    c("GO:0016043", "cellular component organization", 26.598906894237224, 6, 0.8711366290442887, 0.3663789, "mitochondrion organization"),
    c("GO:0022607", "cellular component assembly", 11.228305686067696, 5, 0.8781490881730596, 0.53047588, "mitochondrion organization"),
    c("GO:0043933", "protein-containing complex organization", 9.176335219100585, 5, 0.8930066738484164, 0.50164209, "mitochondrion organization"),
    c("GO:0044085", "cellular component biogenesis", 12.431680889826445, 5, 0.888954671044743, 0.54631759, "mitochondrion organization"),
    c("GO:0071840", "cellular component organization or biogenesis", 27.62009780419983, 6, 0.9611050275922705, 0.02360138, "cellular component organization or biogenesis"),
    c("GO:0098662", "inorganic cation transmembrane transport", 3.1882251414325435, 4, 0.8052270786313491, 0.0155017, "inorganic cation transmembrane transport"),
    c("GO:0006810", "transport", 18.036245085818393, 4, 0.8384371142578271, 0.57029688, "inorganic cation transmembrane transport"),
    c("GO:0006811", "monoatomic ion transport", 4.813500815034998, 4, 0.8651200792381154, 0.43332817, "inorganic cation transmembrane transport"),
    c("GO:0055085", "transmembrane transport", 6.141528430338479, 4, 0.8364892194136168, 0.60115539, "inorganic cation transmembrane transport")
)
upButyrate_BP <- data.frame(upButyrate_BP_revigo.data)
names(upButyrate_BP) <- upButyrate_BP_revigo.names
upButyrate_BP$value <- as.numeric(as.character(upButyrate_BP$value))
upButyrate_BP$frequency <- as.numeric(as.character(upButyrate_BP$frequency))
upButyrate_BP$uniqueness <- as.numeric(as.character(upButyrate_BP$uniqueness))
upButyrate_BP$dispensability <- as.numeric(as.character(upButyrate_BP$dispensability))
# check the tmPlot command documentation for all possible parameters - there are a lot more
treemap(
    upButyrate_BP,
    index = c("representative", "description"),
    vSize = "value",
    type = "categorical",
    vColor = "representative",
    title = "Biological Processes - Genes upregulated in Butyrate",
    inflate.labels = FALSE, # set this to TRUE for space-filling group labels - good for posters
    lowerbound.cex.labels = 0, # try to draw as many labels as possible (still, some small squares may not get a label)
    bg.labels = "#CCCCCCAA", # define background color of group labels
    # "#CCCCCC00" is fully transparent, "#CCCCCCAA" is semi-transparent grey, NA is opaque
    position.legend = "none", fontsize.title = 30, fontsize.labels = 16
)
```

GO pathways gene sets downloaded from <https://amigo.geneontology.org/>

```{r heatmapsfromGOGroups}
filterset <- dplyr::filter(butyrate_vs_control, Adj_P_Value <= 0.05, abs(Log2FoldChange) >= 0.3)
filterset <- dplyr::select(filterset, MGI_Symbol)
heatmapgenes <- dplyr::filter(rlog_df, MGI_Symbol %in% filterset$MGI_Symbol)

heatmapFromCSV(
    plottitle = "Regulation of Apoptotic Processes",
    fname = paste(cwd, "GOgenesets/apoptotic.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 5
)

heatmapFromCSV(
    plottitle = "Regulation of Programmed Cell Death",
    fname = paste(cwd, "GOgenesets/programmedcelldeath.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

heatmapFromCSV(
    plottitle = "Regulation of Immune System Process",
    fname = paste(cwd, "GOgenesets/immunesystemprocess.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

heatmapFromCSV(
    plottitle = "Regulation of Cytokine Production",
    fname = paste(cwd, "GOgenesets/cytokineproduction.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

heatmapFromCSV(
    plottitle = "Regulation of Response to Stress",
    fname = paste(cwd, "GOgenesets/stressresponse.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

negative_regulation_of_gene_expression <- consolidate_gene_list(gmap,
    fname = paste(cwd, "GOgenesets/apoptotic.csv", sep = "/"),
    fname = paste(cwd, "GOgenesets/programmedcelldeath.csv", sep = "/"),
    fname = paste(cwd, "GOgenesets/immunesystemprocess.csv", sep = "/"),
    fname = paste(cwd, "GOgenesets/cytokineproduction.csv", sep = "/"),
    fname = paste(cwd, "GOgenesets/stressresponse.csv", sep = "/")
)
heatmapFromDF("Negative Regulation of Gene Expression",
    negative_regulation_of_gene_expression,
    meta,
    heatmapgenes,
    anno_colors,
    gaps = c(5),
    height = 4
)

heatmapFromCSV(
    plottitle = "Cell Differentiation",
    fname = paste(cwd, "GOgenesets/celldiff.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

heatmapFromCSV(
    plottitle = "Cytokine Production",
    fname = paste(cwd, "GOgenesets/cytokineprod.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

heatmapFromCSV(
    plottitle = "Cellular Response to Stimulus",
    fname = paste(cwd, "GOgenesets/stimulusresponse.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

heatmapFromCSV(
    plottitle = "Response to Stress",
    fname = paste(cwd, "GOgenesets/stress.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

heatmapFromCSV(
    plottitle = "Defense Response",
    fname = paste(cwd, "GOgenesets/defense.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

woundingresponse <- consolidate_gene_list(gmap,
    fname = paste(cwd, "GOgenesets/stimulusresponse.csv", sep = "/"),
    fname = paste(cwd, "GOgenesets/stress.csv", sep = "/"),
    fname = paste(cwd, "GOgenesets/defense.csv", sep = "/")
)
heatmapFromDF("Response to Wounding",
    woundingresponse,
    meta,
    heatmapgenes,
    anno_colors,
    gaps = c(5),
    height = 8
)

heatmapFromCSV(
    plottitle = "Export From Cell",
    fname = paste(cwd, "GOgenesets/export.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

heatmapFromCSV(
    plottitle = "Cell Death",
    fname = paste(cwd, "GOgenesets/celldeath.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

heatmapFromCSV(
    plottitle = "Cell Proliferation",
    fname = paste(cwd, "GOgenesets/cellprolif.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = FALSE,
    height = 8
)

heatmapFromCSV(
    plottitle = "Cell-Cell Signaling",
    fname = paste(cwd, "GOgenesets/signaling.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

heatmapFromCSV(
    plottitle = "Cellular Component Organization",
    fname = paste(cwd, "GOgenesets/cco.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

heatmapFromCSV(
    plottitle = "Immune Effector Processes",
    fname = paste(cwd, "GOgenesets/immuneeffector.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = FALSE,
    height = 8
)

heatmapFromCSV(
    plottitle = "Apoptotic Processes",
    fname = paste(cwd, "GOgenesets/apoptoticprocess.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)

heatmapFromCSV(
    plottitle = "Cell Migration",
    fname = paste(cwd, "GOgenesets/migration.csv", sep = "/"),
    met = meta,
    counts_df = heatmapgenes,
    annocolors = anno_colors,
    gaps = c(5),
    clusterRows = TRUE,
    height = 8
)
```

# CITATIONS

```{r citations}
citation("DESeq2")
citation("pcaExplorer")
```
